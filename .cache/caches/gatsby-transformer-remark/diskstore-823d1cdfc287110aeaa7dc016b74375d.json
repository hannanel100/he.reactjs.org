{"expireTime":9007200917365139000,"key":"transformer-remark-markdown-html-ast-c99a2a0064aedc86f60fdd882f551582-gatsby-remark-responsive-iframegatsby-remark-imagesgatsby-remark-external-linksgatsby-remark-header-custom-idsgatsby-remark-code-replsgatsby-remark-embed-snippetgatsby-remark-use-jsxgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This section is a collection of implementation notes for the ","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":62,"offset":62}}},{"type":"element","tagName":"a","properties":{"href":"/docs/codebase-overview.html#stack-reconciler"},"children":[{"type":"text","value":"stack reconciler","position":{"start":{"line":2,"column":63,"offset":63},"end":{"line":2,"column":79,"offset":79}}}],"position":{"start":{"line":2,"column":62,"offset":62},"end":{"line":2,"column":127,"offset":127}}},{"type":"text","value":".","position":{"start":{"line":2,"column":127,"offset":127},"end":{"line":2,"column":128,"offset":128}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":128,"offset":128}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It is very technical and assumes a strong understanding of React public API as well as how it’s divided into core, renderers, and the reconciler. If you’re not very familiar with the React codebase, read ","position":{"start":{"line":4,"column":1,"offset":130},"end":{"line":4,"column":205,"offset":334}}},{"type":"element","tagName":"a","properties":{"href":"/docs/codebase-overview.html"},"children":[{"type":"text","value":"the codebase overview","position":{"start":{"line":4,"column":206,"offset":335},"end":{"line":4,"column":227,"offset":356}}}],"position":{"start":{"line":4,"column":205,"offset":334},"end":{"line":4,"column":258,"offset":387}}},{"type":"text","value":" first.","position":{"start":{"line":4,"column":258,"offset":387},"end":{"line":4,"column":265,"offset":394}}}],"position":{"start":{"line":4,"column":1,"offset":130},"end":{"line":4,"column":265,"offset":394}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It also assumes an understanding of the ","position":{"start":{"line":6,"column":1,"offset":396},"end":{"line":6,"column":41,"offset":436}}},{"type":"element","tagName":"a","properties":{"href":"/blog/2015/12/18/react-components-elements-and-instances.html"},"children":[{"type":"text","value":"differences between React components, their instances, and elements","position":{"start":{"line":6,"column":42,"offset":437},"end":{"line":6,"column":109,"offset":504}}}],"position":{"start":{"line":6,"column":41,"offset":436},"end":{"line":6,"column":173,"offset":568}}},{"type":"text","value":".","position":{"start":{"line":6,"column":173,"offset":568},"end":{"line":6,"column":174,"offset":569}}}],"position":{"start":{"line":6,"column":1,"offset":396},"end":{"line":6,"column":174,"offset":569}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The stack reconciler was used in React 15 and earlier. It is located at ","position":{"start":{"line":8,"column":1,"offset":571},"end":{"line":8,"column":73,"offset":643}}},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/tree/15-stable/src/renderers/shared/stack/reconciler","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"src/renderers/shared/stack/reconciler","position":{"start":{"line":8,"column":74,"offset":644},"end":{"line":8,"column":111,"offset":681}}}],"position":{"start":{"line":8,"column":73,"offset":643},"end":{"line":8,"column":200,"offset":770}}},{"type":"text","value":".","position":{"start":{"line":8,"column":200,"offset":770},"end":{"line":8,"column":201,"offset":771}}}],"position":{"start":{"line":8,"column":1,"offset":571},"end":{"line":8,"column":201,"offset":771}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"video-building-react-from-scratch"},"children":[{"type":"element","tagName":"a","properties":{"href":"#video-building-react-from-scratch","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Video: Building React from Scratch ","position":{"start":{"line":10,"column":5,"offset":777},"end":{"line":10,"column":76,"offset":848}}}],"position":{"start":{"line":10,"column":1,"offset":773},"end":{"line":10,"column":76,"offset":848}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://twitter.com/zpao","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"Paul O’Shannessy","position":{"start":{"line":12,"column":2,"offset":851},"end":{"line":12,"column":18,"offset":867}}}],"position":{"start":{"line":12,"column":1,"offset":850},"end":{"line":12,"column":45,"offset":894}}},{"type":"text","value":" gave a talk about ","position":{"start":{"line":12,"column":45,"offset":894},"end":{"line":12,"column":64,"offset":913}}},{"type":"element","tagName":"a","properties":{"href":"https://www.youtube.com/watch?v=_MAD4Oly9yg","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"building React from scratch","position":{"start":{"line":12,"column":65,"offset":914},"end":{"line":12,"column":92,"offset":941}}}],"position":{"start":{"line":12,"column":64,"offset":913},"end":{"line":12,"column":138,"offset":987}}},{"type":"text","value":" that largely inspired this document.","position":{"start":{"line":12,"column":138,"offset":987},"end":{"line":12,"column":175,"offset":1024}}}],"position":{"start":{"line":12,"column":1,"offset":850},"end":{"line":12,"column":175,"offset":1024}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Both this document and his talk are simplifications of the real codebase so you might get a better understanding by getting familiar with both of them.","position":{"start":{"line":14,"column":1,"offset":1026},"end":{"line":14,"column":152,"offset":1177}}}],"position":{"start":{"line":14,"column":1,"offset":1026},"end":{"line":14,"column":152,"offset":1177}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"overview"},"children":[{"type":"element","tagName":"a","properties":{"href":"#overview","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Overview ","position":{"start":{"line":16,"column":5,"offset":1183},"end":{"line":16,"column":25,"offset":1203}}}],"position":{"start":{"line":16,"column":1,"offset":1179},"end":{"line":16,"column":25,"offset":1203}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The reconciler itself doesn’t have a public API. ","position":{"start":{"line":18,"column":1,"offset":1205},"end":{"line":18,"column":50,"offset":1254}}},{"type":"element","tagName":"a","properties":{"href":"/docs/codebase-overview.html#renderers"},"children":[{"type":"text","value":"Renderers","position":{"start":{"line":18,"column":51,"offset":1255},"end":{"line":18,"column":60,"offset":1264}}}],"position":{"start":{"line":18,"column":50,"offset":1254},"end":{"line":18,"column":101,"offset":1305}}},{"type":"text","value":" like React DOM and React Native use it to efficiently update the user interface according to the React components written by the user.","position":{"start":{"line":18,"column":101,"offset":1305},"end":{"line":18,"column":236,"offset":1440}}}],"position":{"start":{"line":18,"column":1,"offset":1205},"end":{"line":18,"column":236,"offset":1440}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"mounting-as-a-recursive-process"},"children":[{"type":"element","tagName":"a","properties":{"href":"#mounting-as-a-recursive-process","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Mounting as a Recursive Process ","position":{"start":{"line":20,"column":5,"offset":1446},"end":{"line":20,"column":71,"offset":1512}}}],"position":{"start":{"line":20,"column":1,"offset":1442},"end":{"line":20,"column":71,"offset":1512}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let’s consider the first time you mount a component:","position":{"start":{"line":22,"column":1,"offset":1514},"end":{"line":22,"column":53,"offset":1566}}}],"position":{"start":{"line":22,"column":1,"offset":1514},"end":{"line":22,"column":53,"offset":1566}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>rootEl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nroot<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":24,"column":1,"offset":1568},"end":{"line":27,"column":4,"offset":1641}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">root.render</code>","position":{"start":{"line":29,"column":1,"offset":1643},"end":{"line":29,"column":14,"offset":1656}}},{"type":"text","value":" will pass ","position":{"start":{"line":29,"column":14,"offset":1656},"end":{"line":29,"column":25,"offset":1667}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;App /></code>","position":{"start":{"line":29,"column":25,"offset":1667},"end":{"line":29,"column":34,"offset":1676}}},{"type":"text","value":" along to the reconciler. Remember that ","position":{"start":{"line":29,"column":34,"offset":1676},"end":{"line":29,"column":74,"offset":1716}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;App /></code>","position":{"start":{"line":29,"column":74,"offset":1716},"end":{"line":29,"column":83,"offset":1725}}},{"type":"text","value":" is a React element, that is, a description of ","position":{"start":{"line":29,"column":83,"offset":1725},"end":{"line":29,"column":130,"offset":1772}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"what","position":{"start":{"line":29,"column":131,"offset":1773},"end":{"line":29,"column":135,"offset":1777}}}],"position":{"start":{"line":29,"column":130,"offset":1772},"end":{"line":29,"column":136,"offset":1778}}},{"type":"text","value":" to render. You can think about it as a plain object:","position":{"start":{"line":29,"column":136,"offset":1778},"end":{"line":29,"column":189,"offset":1831}}}],"position":{"start":{"line":29,"column":1,"offset":1643},"end":{"line":29,"column":189,"offset":1831}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// { type: App, props: {} }</span></code></pre></div>","position":{"start":{"line":31,"column":1,"offset":1833},"end":{"line":34,"column":4,"offset":1892}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The reconciler will check if ","position":{"start":{"line":36,"column":1,"offset":1894},"end":{"line":36,"column":30,"offset":1923}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":36,"column":30,"offset":1923},"end":{"line":36,"column":35,"offset":1928}}},{"type":"text","value":" is a class or a function.","position":{"start":{"line":36,"column":35,"offset":1928},"end":{"line":36,"column":61,"offset":1954}}}],"position":{"start":{"line":36,"column":1,"offset":1894},"end":{"line":36,"column":61,"offset":1954}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If ","position":{"start":{"line":38,"column":1,"offset":1956},"end":{"line":38,"column":4,"offset":1959}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":38,"column":4,"offset":1959},"end":{"line":38,"column":9,"offset":1964}}},{"type":"text","value":" is a function, the reconciler will call ","position":{"start":{"line":38,"column":9,"offset":1964},"end":{"line":38,"column":50,"offset":2005}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App(props)</code>","position":{"start":{"line":38,"column":50,"offset":2005},"end":{"line":38,"column":62,"offset":2017}}},{"type":"text","value":" to get the rendered element.","position":{"start":{"line":38,"column":62,"offset":2017},"end":{"line":38,"column":91,"offset":2046}}}],"position":{"start":{"line":38,"column":1,"offset":1956},"end":{"line":38,"column":91,"offset":2046}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If ","position":{"start":{"line":40,"column":1,"offset":2048},"end":{"line":40,"column":4,"offset":2051}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":40,"column":4,"offset":2051},"end":{"line":40,"column":9,"offset":2056}}},{"type":"text","value":" is a class, the reconciler will instantiate an ","position":{"start":{"line":40,"column":9,"offset":2056},"end":{"line":40,"column":57,"offset":2104}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":40,"column":57,"offset":2104},"end":{"line":40,"column":62,"offset":2109}}},{"type":"text","value":" with ","position":{"start":{"line":40,"column":62,"offset":2109},"end":{"line":40,"column":68,"offset":2115}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">new App(props)</code>","position":{"start":{"line":40,"column":68,"offset":2115},"end":{"line":40,"column":84,"offset":2131}}},{"type":"text","value":", call the ","position":{"start":{"line":40,"column":84,"offset":2131},"end":{"line":40,"column":95,"offset":2142}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">componentWillMount()</code>","position":{"start":{"line":40,"column":95,"offset":2142},"end":{"line":40,"column":117,"offset":2164}}},{"type":"text","value":" lifecycle method, and then will call the ","position":{"start":{"line":40,"column":117,"offset":2164},"end":{"line":40,"column":159,"offset":2206}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">render()</code>","position":{"start":{"line":40,"column":159,"offset":2206},"end":{"line":40,"column":169,"offset":2216}}},{"type":"text","value":" method to get the rendered element.","position":{"start":{"line":40,"column":169,"offset":2216},"end":{"line":40,"column":205,"offset":2252}}}],"position":{"start":{"line":40,"column":1,"offset":2048},"end":{"line":40,"column":205,"offset":2252}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Either way, the reconciler will learn the element ","position":{"start":{"line":42,"column":1,"offset":2254},"end":{"line":42,"column":51,"offset":2304}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":42,"column":51,"offset":2304},"end":{"line":42,"column":56,"offset":2309}}},{"type":"text","value":" “rendered to”.","position":{"start":{"line":42,"column":56,"offset":2309},"end":{"line":42,"column":71,"offset":2324}}}],"position":{"start":{"line":42,"column":1,"offset":2254},"end":{"line":42,"column":71,"offset":2324}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This process is recursive. ","position":{"start":{"line":44,"column":1,"offset":2326},"end":{"line":44,"column":28,"offset":2353}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":44,"column":28,"offset":2353},"end":{"line":44,"column":33,"offset":2358}}},{"type":"text","value":" may render to a ","position":{"start":{"line":44,"column":33,"offset":2358},"end":{"line":44,"column":50,"offset":2375}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;Greeting /></code>","position":{"start":{"line":44,"column":50,"offset":2375},"end":{"line":44,"column":64,"offset":2389}}},{"type":"text","value":", ","position":{"start":{"line":44,"column":64,"offset":2389},"end":{"line":44,"column":66,"offset":2391}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">Greeting</code>","position":{"start":{"line":44,"column":66,"offset":2391},"end":{"line":44,"column":76,"offset":2401}}},{"type":"text","value":" may render to a ","position":{"start":{"line":44,"column":76,"offset":2401},"end":{"line":44,"column":93,"offset":2418}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;Button /></code>","position":{"start":{"line":44,"column":93,"offset":2418},"end":{"line":44,"column":105,"offset":2430}}},{"type":"text","value":", and so on. The reconciler will “drill down” through user-defined components recursively as it learns what each component renders to.","position":{"start":{"line":44,"column":105,"offset":2430},"end":{"line":44,"column":239,"offset":2564}}}],"position":{"start":{"line":44,"column":1,"offset":2326},"end":{"line":44,"column":239,"offset":2564}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can imagine this process as a pseudocode:","position":{"start":{"line":46,"column":1,"offset":2566},"end":{"line":46,"column":46,"offset":2611}}}],"position":{"start":{"line":46,"column":1,"offset":2566},"end":{"line":46,"column":46,"offset":2611}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">isClass</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// React.Component subclasses have this flag</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>isReactComponent<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// This function takes a React element (e.g. &lt;App />)</span>\n<span class=\"token comment\">// and returns a DOM or Native node representing the mounted tree.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// We will determine the rendered element</span>\n  <span class=\"token comment\">// by either running the type as function</span>\n  <span class=\"token comment\">// or creating an instance and calling render().</span>\n  <span class=\"token keyword\">var</span> renderedElement<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isClass</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Component class</span>\n    <span class=\"token keyword\">var</span> publicInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Set the props</span>\n    publicInstance<span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Call the lifecycle if necessary</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicInstance<span class=\"token punctuation\">.</span>componentWillMount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">componentWillMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// Get the rendered element by calling render()</span>\n    renderedElement <span class=\"token operator\">=</span> publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Component function</span>\n    renderedElement <span class=\"token operator\">=</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// This process is recursive because a component may</span>\n  <span class=\"token comment\">// return an element with a type of another component.</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span>renderedElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Note: this implementation is incomplete and recurses infinitely!</span>\n  <span class=\"token comment\">// It only handles elements like &lt;App /> or &lt;Button />.</span>\n  <span class=\"token comment\">// It doesn't handle elements like &lt;div /> or &lt;p /> yet.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> rootEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nrootEl<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":48,"column":1,"offset":2613},"end":{"line":95,"column":4,"offset":4042}}},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:","position":{"start":{"line":97,"column":4,"offset":4047},"end":{"line":97,"column":9,"offset":4052}}}],"position":{"start":{"line":97,"column":2,"offset":4045},"end":{"line":97,"column":11,"offset":4054}}}],"position":{"start":{"line":97,"column":2,"offset":4045},"end":{"line":97,"column":11,"offset":4054}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This really ","position":{"start":{"line":99,"column":2,"offset":4058},"end":{"line":99,"column":14,"offset":4070}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"is","position":{"start":{"line":99,"column":15,"offset":4071},"end":{"line":99,"column":17,"offset":4073}}}],"position":{"start":{"line":99,"column":14,"offset":4070},"end":{"line":99,"column":18,"offset":4074}}},{"type":"text","value":" a pseudo-code. It isn’t similar to the real implementation. It will also cause a stack overflow because we haven’t discussed when to stop the recursion.","position":{"start":{"line":99,"column":18,"offset":4074},"end":{"line":99,"column":171,"offset":4227}}}],"position":{"start":{"line":99,"column":2,"offset":4058},"end":{"line":99,"column":171,"offset":4227}}},{"type":"text","value":"\n"}],"position":{"start":{"line":97,"column":1,"offset":4044},"end":{"line":99,"column":171,"offset":4227}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let’s recap a few key ideas in the example above:","position":{"start":{"line":101,"column":1,"offset":4229},"end":{"line":101,"column":50,"offset":4278}}}],"position":{"start":{"line":101,"column":1,"offset":4229},"end":{"line":101,"column":50,"offset":4278}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"React elements are plain objects representing the component type (e.g. ","position":{"start":{"line":103,"column":3,"offset":4282},"end":{"line":103,"column":74,"offset":4353}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":103,"column":74,"offset":4353},"end":{"line":103,"column":79,"offset":4358}}},{"type":"text","value":") and the props.","position":{"start":{"line":103,"column":79,"offset":4358},"end":{"line":103,"column":95,"offset":4374}}}],"position":{"start":{"line":103,"column":1,"offset":4280},"end":{"line":103,"column":95,"offset":4374}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"User-defined components (e.g. ","position":{"start":{"line":104,"column":3,"offset":4377},"end":{"line":104,"column":33,"offset":4407}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">App</code>","position":{"start":{"line":104,"column":33,"offset":4407},"end":{"line":104,"column":38,"offset":4412}}},{"type":"text","value":") can be classes or functions but they all “render to” elements.","position":{"start":{"line":104,"column":38,"offset":4412},"end":{"line":104,"column":102,"offset":4476}}}],"position":{"start":{"line":104,"column":1,"offset":4375},"end":{"line":104,"column":102,"offset":4476}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"“Mounting” is a recursive process that creates a DOM or Native tree given the top-level React element (e.g. ","position":{"start":{"line":105,"column":3,"offset":4479},"end":{"line":105,"column":111,"offset":4587}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;App /></code>","position":{"start":{"line":105,"column":111,"offset":4587},"end":{"line":105,"column":120,"offset":4596}}},{"type":"text","value":").","position":{"start":{"line":105,"column":120,"offset":4596},"end":{"line":105,"column":122,"offset":4598}}}],"position":{"start":{"line":105,"column":1,"offset":4477},"end":{"line":105,"column":122,"offset":4598}}},{"type":"text","value":"\n"}],"position":{"start":{"line":103,"column":1,"offset":4280},"end":{"line":105,"column":122,"offset":4598}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"mounting-host-elements"},"children":[{"type":"element","tagName":"a","properties":{"href":"#mounting-host-elements","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Mounting Host Elements ","position":{"start":{"line":107,"column":5,"offset":4604},"end":{"line":107,"column":53,"offset":4652}}}],"position":{"start":{"line":107,"column":1,"offset":4600},"end":{"line":107,"column":53,"offset":4652}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This process would be useless if we didn’t render something to the screen as a result.","position":{"start":{"line":109,"column":1,"offset":4654},"end":{"line":109,"column":87,"offset":4740}}}],"position":{"start":{"line":109,"column":1,"offset":4654},"end":{"line":109,"column":87,"offset":4740}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In addition to user-defined (“composite”) components, React elements may also represent platform-specific (“host”) components. For example, ","position":{"start":{"line":111,"column":1,"offset":4742},"end":{"line":111,"column":141,"offset":4882}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">Button</code>","position":{"start":{"line":111,"column":141,"offset":4882},"end":{"line":111,"column":149,"offset":4890}}},{"type":"text","value":" might return a ","position":{"start":{"line":111,"column":149,"offset":4890},"end":{"line":111,"column":165,"offset":4906}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;div /></code>","position":{"start":{"line":111,"column":165,"offset":4906},"end":{"line":111,"column":174,"offset":4915}}},{"type":"text","value":" from its render method.","position":{"start":{"line":111,"column":174,"offset":4915},"end":{"line":111,"column":198,"offset":4939}}}],"position":{"start":{"line":111,"column":1,"offset":4742},"end":{"line":111,"column":198,"offset":4939}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If element’s ","position":{"start":{"line":113,"column":1,"offset":4941},"end":{"line":113,"column":14,"offset":4954}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">type</code>","position":{"start":{"line":113,"column":14,"offset":4954},"end":{"line":113,"column":20,"offset":4960}}},{"type":"text","value":" property is a string, we are dealing with a host element:","position":{"start":{"line":113,"column":20,"offset":4960},"end":{"line":113,"column":78,"offset":5018}}}],"position":{"start":{"line":113,"column":1,"offset":4941},"end":{"line":113,"column":78,"offset":5018}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// { type: 'div', props: {} }</span></code></pre></div>","position":{"start":{"line":115,"column":1,"offset":5020},"end":{"line":118,"column":4,"offset":5081}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is no user-defined code associated with host elements.","position":{"start":{"line":120,"column":1,"offset":5083},"end":{"line":120,"column":61,"offset":5143}}}],"position":{"start":{"line":120,"column":1,"offset":5083},"end":{"line":120,"column":61,"offset":5143}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When the reconciler encounters a host element, it lets the renderer take care of mounting it. For example, React DOM would create a DOM node.","position":{"start":{"line":122,"column":1,"offset":5145},"end":{"line":122,"column":142,"offset":5286}}}],"position":{"start":{"line":122,"column":1,"offset":5145},"end":{"line":122,"column":142,"offset":5286}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If the host element has children, the reconciler recursively mounts them following the same algorithm as above. It doesn’t matter whether children are host (like ","position":{"start":{"line":124,"column":1,"offset":5288},"end":{"line":124,"column":163,"offset":5450}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;div>&lt;hr />&lt;/div></code>","position":{"start":{"line":124,"column":163,"offset":5450},"end":{"line":124,"column":182,"offset":5469}}},{"type":"text","value":"), composite (like ","position":{"start":{"line":124,"column":182,"offset":5469},"end":{"line":124,"column":201,"offset":5488}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;div>&lt;Button />&lt;/div></code>","position":{"start":{"line":124,"column":201,"offset":5488},"end":{"line":124,"column":224,"offset":5511}}},{"type":"text","value":"), or both.","position":{"start":{"line":124,"column":224,"offset":5511},"end":{"line":124,"column":235,"offset":5522}}}],"position":{"start":{"line":124,"column":1,"offset":5288},"end":{"line":124,"column":235,"offset":5522}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The DOM nodes produced by the child components will be appended to the parent DOM node, and recursively, the complete DOM structure will be assembled.","position":{"start":{"line":126,"column":1,"offset":5524},"end":{"line":126,"column":151,"offset":5674}}}],"position":{"start":{"line":126,"column":1,"offset":5524},"end":{"line":126,"column":151,"offset":5674}}},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:","position":{"start":{"line":128,"column":4,"offset":5679},"end":{"line":128,"column":9,"offset":5684}}}],"position":{"start":{"line":128,"column":2,"offset":5677},"end":{"line":128,"column":11,"offset":5686}}}],"position":{"start":{"line":128,"column":2,"offset":5677},"end":{"line":128,"column":11,"offset":5686}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The reconciler itself is not tied to the DOM. The exact result of mounting (sometimes called “mount image” in the source code) depends on the renderer, and can be a DOM node (React DOM), a string (React DOM Server), or a number representing a native view (React Native).","position":{"start":{"line":130,"column":2,"offset":5690},"end":{"line":130,"column":272,"offset":5960}}}],"position":{"start":{"line":130,"column":2,"offset":5690},"end":{"line":130,"column":272,"offset":5960}}},{"type":"text","value":"\n"}],"position":{"start":{"line":128,"column":1,"offset":5676},"end":{"line":130,"column":272,"offset":5960}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we were to extend the code to handle host elements, it would look like this:","position":{"start":{"line":132,"column":1,"offset":5962},"end":{"line":132,"column":80,"offset":6041}}}],"position":{"start":{"line":132,"column":1,"offset":5962},"end":{"line":132,"column":80,"offset":6041}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">isClass</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// React.Component subclasses have this flag</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>isReactComponent<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// This function only handles elements with a composite type.</span>\n<span class=\"token comment\">// For example, it handles &lt;App /> and &lt;Button />, but not a &lt;div />.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">mountComposite</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> renderedElement<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isClass</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Component class</span>\n    <span class=\"token keyword\">var</span> publicInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Set the props</span>\n    publicInstance<span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Call the lifecycle if necessary</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicInstance<span class=\"token punctuation\">.</span>componentWillMount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">componentWillMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    renderedElement <span class=\"token operator\">=</span> publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> type <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Component function</span>\n    renderedElement <span class=\"token operator\">=</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// This is recursive but we'll eventually reach the bottom of recursion when</span>\n  <span class=\"token comment\">// the element is host (e.g. &lt;div />) rather than composite (e.g. &lt;App />):</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span>renderedElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// This function only handles elements with a host type.</span>\n<span class=\"token comment\">// For example, it handles &lt;div /> and &lt;p /> but not an &lt;App />.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">mountHost</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> children <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>children <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    children <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>children<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  children <span class=\"token operator\">=</span> children<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>Boolean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// This block of code shouldn't be in the reconciler.</span>\n  <span class=\"token comment\">// Different renderers might initialize nodes differently.</span>\n  <span class=\"token comment\">// For example, React Native would create iOS or Android views.</span>\n  <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">propName</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propName <span class=\"token operator\">!==</span> <span class=\"token string\">'children'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span>propName<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">[</span>propName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Mount the children</span>\n  children<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">childElement</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Children may be host (e.g. &lt;div />) or composite (e.g. &lt;Button />).</span>\n    <span class=\"token comment\">// We will also mount them recursively:</span>\n    <span class=\"token keyword\">var</span> childNode <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span>childElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// This line of code is also renderer-specific.</span>\n    <span class=\"token comment\">// It would be different depending on the renderer:</span>\n    node<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>childNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Return the DOM node as mount result.</span>\n  <span class=\"token comment\">// This is where the recursion ends.</span>\n  <span class=\"token keyword\">return</span> node<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> type <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// User-defined components</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">mountComposite</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> type <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Platform-specific components</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">mountHost</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> rootEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nrootEl<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":134,"column":1,"offset":6043},"end":{"line":221,"column":4,"offset":8651}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is working but still far from how the reconciler is really implemented. The key missing ingredient is support for updates.","position":{"start":{"line":223,"column":1,"offset":8653},"end":{"line":223,"column":128,"offset":8780}}}],"position":{"start":{"line":223,"column":1,"offset":8653},"end":{"line":223,"column":128,"offset":8780}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"introducing-internal-instances"},"children":[{"type":"element","tagName":"a","properties":{"href":"#introducing-internal-instances","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Introducing Internal Instances ","position":{"start":{"line":225,"column":5,"offset":8786},"end":{"line":225,"column":69,"offset":8850}}}],"position":{"start":{"line":225,"column":1,"offset":8782},"end":{"line":225,"column":69,"offset":8850}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The key feature of React is that you can re-render everything, and it won’t recreate the DOM or reset the state:","position":{"start":{"line":227,"column":1,"offset":8852},"end":{"line":227,"column":113,"offset":8964}}}],"position":{"start":{"line":227,"column":1,"offset":8852},"end":{"line":227,"column":113,"offset":8964}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\">root<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Should reuse the existing DOM:</span>\nroot<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":229,"column":1,"offset":8966},"end":{"line":233,"column":4,"offset":9053}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However, our implementation above only knows how to mount the initial tree. It can’t perform updates on it because it doesn’t store all the necessary information, such as all the ","position":{"start":{"line":235,"column":1,"offset":9055},"end":{"line":235,"column":180,"offset":9234}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">publicInstance</code>","position":{"start":{"line":235,"column":180,"offset":9234},"end":{"line":235,"column":196,"offset":9250}}},{"type":"text","value":"s, or which DOM ","position":{"start":{"line":235,"column":196,"offset":9250},"end":{"line":235,"column":212,"offset":9266}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">node</code>","position":{"start":{"line":235,"column":212,"offset":9266},"end":{"line":235,"column":218,"offset":9272}}},{"type":"text","value":"s correspond to which components.","position":{"start":{"line":235,"column":218,"offset":9272},"end":{"line":235,"column":251,"offset":9305}}}],"position":{"start":{"line":235,"column":1,"offset":9055},"end":{"line":235,"column":251,"offset":9305}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The stack reconciler codebase solves this by making the ","position":{"start":{"line":237,"column":1,"offset":9307},"end":{"line":237,"column":57,"offset":9363}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mount()</code>","position":{"start":{"line":237,"column":57,"offset":9363},"end":{"line":237,"column":66,"offset":9372}}},{"type":"text","value":" function a method and putting it on a class. There are drawbacks to this approach, and we are going in the opposite direction in the ","position":{"start":{"line":237,"column":66,"offset":9372},"end":{"line":237,"column":200,"offset":9506}}},{"type":"element","tagName":"a","properties":{"href":"/docs/codebase-overview.html#fiber-reconciler"},"children":[{"type":"text","value":"ongoing rewrite of the reconciler","position":{"start":{"line":237,"column":201,"offset":9507},"end":{"line":237,"column":234,"offset":9540}}}],"position":{"start":{"line":237,"column":200,"offset":9506},"end":{"line":237,"column":282,"offset":9588}}},{"type":"text","value":". Nevertheless this is how it works now.","position":{"start":{"line":237,"column":282,"offset":9588},"end":{"line":237,"column":322,"offset":9628}}}],"position":{"start":{"line":237,"column":1,"offset":9307},"end":{"line":237,"column":322,"offset":9628}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Instead of separate ","position":{"start":{"line":239,"column":1,"offset":9630},"end":{"line":239,"column":21,"offset":9650}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountHost</code>","position":{"start":{"line":239,"column":21,"offset":9650},"end":{"line":239,"column":32,"offset":9661}}},{"type":"text","value":" and ","position":{"start":{"line":239,"column":32,"offset":9661},"end":{"line":239,"column":37,"offset":9666}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountComposite</code>","position":{"start":{"line":239,"column":37,"offset":9666},"end":{"line":239,"column":53,"offset":9682}}},{"type":"text","value":" functions, we will create two classes: ","position":{"start":{"line":239,"column":53,"offset":9682},"end":{"line":239,"column":93,"offset":9722}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":239,"column":93,"offset":9722},"end":{"line":239,"column":107,"offset":9736}}},{"type":"text","value":" and ","position":{"start":{"line":239,"column":107,"offset":9736},"end":{"line":239,"column":112,"offset":9741}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":239,"column":112,"offset":9741},"end":{"line":239,"column":132,"offset":9761}}},{"type":"text","value":".","position":{"start":{"line":239,"column":132,"offset":9761},"end":{"line":239,"column":133,"offset":9762}}}],"position":{"start":{"line":239,"column":1,"offset":9630},"end":{"line":239,"column":133,"offset":9762}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Both classes have a constructor accepting the ","position":{"start":{"line":241,"column":1,"offset":9764},"end":{"line":241,"column":47,"offset":9810}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">element</code>","position":{"start":{"line":241,"column":47,"offset":9810},"end":{"line":241,"column":56,"offset":9819}}},{"type":"text","value":", as well as a ","position":{"start":{"line":241,"column":56,"offset":9819},"end":{"line":241,"column":71,"offset":9834}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mount()</code>","position":{"start":{"line":241,"column":71,"offset":9834},"end":{"line":241,"column":80,"offset":9843}}},{"type":"text","value":" method returning the mounted node. We will replace a top-level ","position":{"start":{"line":241,"column":80,"offset":9843},"end":{"line":241,"column":144,"offset":9907}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mount()</code>","position":{"start":{"line":241,"column":144,"offset":9907},"end":{"line":241,"column":153,"offset":9916}}},{"type":"text","value":" function with a factory that instantiates the correct class:","position":{"start":{"line":241,"column":153,"offset":9916},"end":{"line":241,"column":214,"offset":9977}}}],"position":{"start":{"line":241,"column":1,"offset":9764},"end":{"line":241,"column":214,"offset":9977}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">instantiateComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> type <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// User-defined components</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CompositeComponent</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> type <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Platform-specific components</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMComponent</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":243,"column":1,"offset":9979},"end":{"line":254,"column":4,"offset":10290}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First, let’s consider the implementation of ","position":{"start":{"line":256,"column":1,"offset":10292},"end":{"line":256,"column":45,"offset":10336}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":256,"column":45,"offset":10336},"end":{"line":256,"column":65,"offset":10356}}},{"type":"text","value":":","position":{"start":{"line":256,"column":65,"offset":10356},"end":{"line":256,"column":66,"offset":10357}}}],"position":{"start":{"line":256,"column":1,"offset":10292},"end":{"line":256,"column":66,"offset":10357}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CompositeComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement <span class=\"token operator\">=</span> element<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedComponent <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>publicInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">getPublicInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// For composite components, expose the class instance.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>publicInstance<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> element <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> publicInstance<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> renderedElement<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isClass</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Component class</span>\n      publicInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Set the props</span>\n      publicInstance<span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Call the lifecycle if necessary</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicInstance<span class=\"token punctuation\">.</span>componentWillMount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">componentWillMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      renderedElement <span class=\"token operator\">=</span> publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> type <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Component function</span>\n      publicInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n      renderedElement <span class=\"token operator\">=</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Save the public instance</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>publicInstance <span class=\"token operator\">=</span> publicInstance<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Instantiate the child internal instance according to the element.</span>\n    <span class=\"token comment\">// It would be a DOMComponent for &lt;div /> or &lt;p />,</span>\n    <span class=\"token comment\">// and a CompositeComponent for &lt;App /> or &lt;Button />:</span>\n    <span class=\"token keyword\">var</span> renderedComponent <span class=\"token operator\">=</span> <span class=\"token function\">instantiateComponent</span><span class=\"token punctuation\">(</span>renderedElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedComponent <span class=\"token operator\">=</span> renderedComponent<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Mount the rendered output</span>\n    <span class=\"token keyword\">return</span> renderedComponent<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":258,"column":1,"offset":10359},"end":{"line":307,"column":4,"offset":11750}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is not much different from our previous ","position":{"start":{"line":309,"column":1,"offset":11752},"end":{"line":309,"column":46,"offset":11797}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountComposite()</code>","position":{"start":{"line":309,"column":46,"offset":11797},"end":{"line":309,"column":64,"offset":11815}}},{"type":"text","value":" implementation, but now we can save some information, such as ","position":{"start":{"line":309,"column":64,"offset":11815},"end":{"line":309,"column":127,"offset":11878}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">this.currentElement</code>","position":{"start":{"line":309,"column":127,"offset":11878},"end":{"line":309,"column":148,"offset":11899}}},{"type":"text","value":", ","position":{"start":{"line":309,"column":148,"offset":11899},"end":{"line":309,"column":150,"offset":11901}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">this.renderedComponent</code>","position":{"start":{"line":309,"column":150,"offset":11901},"end":{"line":309,"column":174,"offset":11925}}},{"type":"text","value":", and ","position":{"start":{"line":309,"column":174,"offset":11925},"end":{"line":309,"column":180,"offset":11931}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">this.publicInstance</code>","position":{"start":{"line":309,"column":180,"offset":11931},"end":{"line":309,"column":201,"offset":11952}}},{"type":"text","value":", for use during updates.","position":{"start":{"line":309,"column":201,"offset":11952},"end":{"line":309,"column":226,"offset":11977}}}],"position":{"start":{"line":309,"column":1,"offset":11752},"end":{"line":309,"column":226,"offset":11977}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that an instance of ","position":{"start":{"line":311,"column":1,"offset":11979},"end":{"line":311,"column":26,"offset":12004}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":311,"column":26,"offset":12004},"end":{"line":311,"column":46,"offset":12024}}},{"type":"text","value":" is not the same thing as an instance of the user-supplied ","position":{"start":{"line":311,"column":46,"offset":12024},"end":{"line":311,"column":105,"offset":12083}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">element.type</code>","position":{"start":{"line":311,"column":105,"offset":12083},"end":{"line":311,"column":119,"offset":12097}}},{"type":"text","value":". ","position":{"start":{"line":311,"column":119,"offset":12097},"end":{"line":311,"column":121,"offset":12099}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":311,"column":121,"offset":12099},"end":{"line":311,"column":141,"offset":12119}}},{"type":"text","value":" is an implementation detail of our reconciler, and is never exposed to the user. The user-defined class is the one we read from ","position":{"start":{"line":311,"column":141,"offset":12119},"end":{"line":311,"column":270,"offset":12248}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">element.type</code>","position":{"start":{"line":311,"column":270,"offset":12248},"end":{"line":311,"column":284,"offset":12262}}},{"type":"text","value":", and ","position":{"start":{"line":311,"column":284,"offset":12262},"end":{"line":311,"column":290,"offset":12268}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":311,"column":290,"offset":12268},"end":{"line":311,"column":310,"offset":12288}}},{"type":"text","value":" creates an instance of it.","position":{"start":{"line":311,"column":310,"offset":12288},"end":{"line":311,"column":337,"offset":12315}}}],"position":{"start":{"line":311,"column":1,"offset":11979},"end":{"line":311,"column":337,"offset":12315}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To avoid the confusion, we will call instances of ","position":{"start":{"line":313,"column":1,"offset":12317},"end":{"line":313,"column":51,"offset":12367}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":313,"column":51,"offset":12367},"end":{"line":313,"column":71,"offset":12387}}},{"type":"text","value":" and ","position":{"start":{"line":313,"column":71,"offset":12387},"end":{"line":313,"column":76,"offset":12392}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":313,"column":76,"offset":12392},"end":{"line":313,"column":90,"offset":12406}}},{"type":"text","value":" “internal instances”. They exist so we can associate some long-lived data with them. Only the renderer and the reconciler are aware that they exist.","position":{"start":{"line":313,"column":90,"offset":12406},"end":{"line":313,"column":239,"offset":12555}}}],"position":{"start":{"line":313,"column":1,"offset":12317},"end":{"line":313,"column":239,"offset":12555}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In contrast, we call an instance of the user-defined class a “public instance”. The public instance is what you see as ","position":{"start":{"line":315,"column":1,"offset":12557},"end":{"line":315,"column":120,"offset":12676}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">this</code>","position":{"start":{"line":315,"column":120,"offset":12676},"end":{"line":315,"column":126,"offset":12682}}},{"type":"text","value":" in the ","position":{"start":{"line":315,"column":126,"offset":12682},"end":{"line":315,"column":134,"offset":12690}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">render()</code>","position":{"start":{"line":315,"column":134,"offset":12690},"end":{"line":315,"column":144,"offset":12700}}},{"type":"text","value":" and other methods of your custom components.","position":{"start":{"line":315,"column":144,"offset":12700},"end":{"line":315,"column":189,"offset":12745}}}],"position":{"start":{"line":315,"column":1,"offset":12557},"end":{"line":315,"column":189,"offset":12745}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The ","position":{"start":{"line":317,"column":1,"offset":12747},"end":{"line":317,"column":5,"offset":12751}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountHost()</code>","position":{"start":{"line":317,"column":5,"offset":12751},"end":{"line":317,"column":18,"offset":12764}}},{"type":"text","value":" function, refactored to be a ","position":{"start":{"line":317,"column":18,"offset":12764},"end":{"line":317,"column":48,"offset":12794}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mount()</code>","position":{"start":{"line":317,"column":48,"offset":12794},"end":{"line":317,"column":57,"offset":12803}}},{"type":"text","value":" method on ","position":{"start":{"line":317,"column":57,"offset":12803},"end":{"line":317,"column":68,"offset":12814}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":317,"column":68,"offset":12814},"end":{"line":317,"column":82,"offset":12828}}},{"type":"text","value":" class, also looks familiar:","position":{"start":{"line":317,"column":82,"offset":12828},"end":{"line":317,"column":110,"offset":12856}}}],"position":{"start":{"line":317,"column":1,"offset":12747},"end":{"line":317,"column":110,"offset":12856}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DOMComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement <span class=\"token operator\">=</span> element<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedChildren <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">getPublicInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// For DOM components, only expose the DOM node.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> element <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> children <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span>children <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      children <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>children<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Create and save the node</span>\n    <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Set the attributes</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">propName</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propName <span class=\"token operator\">!==</span> <span class=\"token string\">'children'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        node<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span>propName<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">[</span>propName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Create and save the contained children.</span>\n    <span class=\"token comment\">// Each of them can be a DOMComponent or a CompositeComponent,</span>\n    <span class=\"token comment\">// depending on whether the element type is a string or a function.</span>\n    <span class=\"token keyword\">var</span> renderedChildren <span class=\"token operator\">=</span> children<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>instantiateComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedChildren <span class=\"token operator\">=</span> renderedChildren<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Collect DOM nodes they return on mount</span>\n    <span class=\"token keyword\">var</span> childNodes <span class=\"token operator\">=</span> renderedChildren<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">child</span> <span class=\"token operator\">=></span> child<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    childNodes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">childNode</span> <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>childNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Return the DOM node as mount result</span>\n    <span class=\"token keyword\">return</span> node<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":319,"column":1,"offset":12858},"end":{"line":366,"column":4,"offset":14156}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The main difference after refactoring from ","position":{"start":{"line":368,"column":1,"offset":14158},"end":{"line":368,"column":44,"offset":14201}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountHost()</code>","position":{"start":{"line":368,"column":44,"offset":14201},"end":{"line":368,"column":57,"offset":14214}}},{"type":"text","value":" is that we now keep ","position":{"start":{"line":368,"column":57,"offset":14214},"end":{"line":368,"column":78,"offset":14235}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">this.node</code>","position":{"start":{"line":368,"column":78,"offset":14235},"end":{"line":368,"column":89,"offset":14246}}},{"type":"text","value":" and ","position":{"start":{"line":368,"column":89,"offset":14246},"end":{"line":368,"column":94,"offset":14251}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">this.renderedChildren</code>","position":{"start":{"line":368,"column":94,"offset":14251},"end":{"line":368,"column":117,"offset":14274}}},{"type":"text","value":" associated with the internal DOM component instance. We will also use them for applying non-destructive updates in the future.","position":{"start":{"line":368,"column":117,"offset":14274},"end":{"line":368,"column":244,"offset":14401}}}],"position":{"start":{"line":368,"column":1,"offset":14158},"end":{"line":368,"column":244,"offset":14401}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As a result, each internal instance, composite or host, now points to its child internal instances. To help visualize this, if a function ","position":{"start":{"line":370,"column":1,"offset":14403},"end":{"line":370,"column":139,"offset":14541}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;App></code>","position":{"start":{"line":370,"column":139,"offset":14541},"end":{"line":370,"column":146,"offset":14548}}},{"type":"text","value":" component renders a ","position":{"start":{"line":370,"column":146,"offset":14548},"end":{"line":370,"column":167,"offset":14569}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;Button></code>","position":{"start":{"line":370,"column":167,"offset":14569},"end":{"line":370,"column":177,"offset":14579}}},{"type":"text","value":" class component, and ","position":{"start":{"line":370,"column":177,"offset":14579},"end":{"line":370,"column":199,"offset":14601}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">Button</code>","position":{"start":{"line":370,"column":199,"offset":14601},"end":{"line":370,"column":207,"offset":14609}}},{"type":"text","value":" class renders a ","position":{"start":{"line":370,"column":207,"offset":14609},"end":{"line":370,"column":224,"offset":14626}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;div></code>","position":{"start":{"line":370,"column":224,"offset":14626},"end":{"line":370,"column":231,"offset":14633}}},{"type":"text","value":", the internal instance tree would look like this:","position":{"start":{"line":370,"column":231,"offset":14633},"end":{"line":370,"column":281,"offset":14683}}}],"position":{"start":{"line":370,"column":1,"offset":14403},"end":{"line":370,"column":281,"offset":14683}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token punctuation\">[</span>object CompositeComponent<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">currentElement</span><span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">publicInstance</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">renderedComponent</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>object CompositeComponent<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">currentElement</span><span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Button</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">publicInstance</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>object Button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">renderedComponent</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>object DOMComponent<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">currentElement</span><span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>object HTMLDivElement<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">renderedChildren</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":372,"column":1,"offset":14685},"end":{"line":386,"column":4,"offset":15049}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the DOM you would only see the ","position":{"start":{"line":388,"column":1,"offset":15051},"end":{"line":388,"column":35,"offset":15085}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;div></code>","position":{"start":{"line":388,"column":35,"offset":15085},"end":{"line":388,"column":42,"offset":15092}}},{"type":"text","value":". However the internal instance tree contains both composite and host internal instances.","position":{"start":{"line":388,"column":42,"offset":15092},"end":{"line":388,"column":131,"offset":15181}}}],"position":{"start":{"line":388,"column":1,"offset":15051},"end":{"line":388,"column":131,"offset":15181}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The composite internal instances need to store:","position":{"start":{"line":390,"column":1,"offset":15183},"end":{"line":390,"column":48,"offset":15230}}}],"position":{"start":{"line":390,"column":1,"offset":15183},"end":{"line":390,"column":48,"offset":15230}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The current element.","position":{"start":{"line":392,"column":3,"offset":15234},"end":{"line":392,"column":23,"offset":15254}}}],"position":{"start":{"line":392,"column":1,"offset":15232},"end":{"line":392,"column":23,"offset":15254}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The public instance if element type is a class.","position":{"start":{"line":393,"column":3,"offset":15257},"end":{"line":393,"column":50,"offset":15304}}}],"position":{"start":{"line":393,"column":1,"offset":15255},"end":{"line":393,"column":50,"offset":15304}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The single rendered internal instance. It can be either a ","position":{"start":{"line":394,"column":3,"offset":15307},"end":{"line":394,"column":61,"offset":15365}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":394,"column":61,"offset":15365},"end":{"line":394,"column":75,"offset":15379}}},{"type":"text","value":" or a ","position":{"start":{"line":394,"column":75,"offset":15379},"end":{"line":394,"column":81,"offset":15385}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":394,"column":81,"offset":15385},"end":{"line":394,"column":101,"offset":15405}}},{"type":"text","value":".","position":{"start":{"line":394,"column":101,"offset":15405},"end":{"line":394,"column":102,"offset":15406}}}],"position":{"start":{"line":394,"column":1,"offset":15305},"end":{"line":394,"column":102,"offset":15406}}},{"type":"text","value":"\n"}],"position":{"start":{"line":392,"column":1,"offset":15232},"end":{"line":394,"column":102,"offset":15406}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The host internal instances need to store:","position":{"start":{"line":396,"column":1,"offset":15408},"end":{"line":396,"column":43,"offset":15450}}}],"position":{"start":{"line":396,"column":1,"offset":15408},"end":{"line":396,"column":43,"offset":15450}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The current element.","position":{"start":{"line":398,"column":3,"offset":15454},"end":{"line":398,"column":23,"offset":15474}}}],"position":{"start":{"line":398,"column":1,"offset":15452},"end":{"line":398,"column":23,"offset":15474}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The DOM node.","position":{"start":{"line":399,"column":3,"offset":15477},"end":{"line":399,"column":16,"offset":15490}}}],"position":{"start":{"line":399,"column":1,"offset":15475},"end":{"line":399,"column":16,"offset":15490}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"All the child internal instances. Each of them can be either a ","position":{"start":{"line":400,"column":3,"offset":15493},"end":{"line":400,"column":66,"offset":15556}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":400,"column":66,"offset":15556},"end":{"line":400,"column":80,"offset":15570}}},{"type":"text","value":" or a ","position":{"start":{"line":400,"column":80,"offset":15570},"end":{"line":400,"column":86,"offset":15576}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":400,"column":86,"offset":15576},"end":{"line":400,"column":106,"offset":15596}}},{"type":"text","value":".","position":{"start":{"line":400,"column":106,"offset":15596},"end":{"line":400,"column":107,"offset":15597}}}],"position":{"start":{"line":400,"column":1,"offset":15491},"end":{"line":400,"column":107,"offset":15597}}},{"type":"text","value":"\n"}],"position":{"start":{"line":398,"column":1,"offset":15452},"end":{"line":400,"column":107,"offset":15597}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you’re struggling to imagine how an internal instance tree is structured in more complex applications, ","position":{"start":{"line":402,"column":1,"offset":15599},"end":{"line":402,"column":107,"offset":15705}}},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react-devtools","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"React DevTools","position":{"start":{"line":402,"column":108,"offset":15706},"end":{"line":402,"column":122,"offset":15720}}}],"position":{"start":{"line":402,"column":107,"offset":15705},"end":{"line":402,"column":167,"offset":15765}}},{"type":"text","value":" can give you a close approximation, as it highlights host instances with grey, and composite instances with purple:","position":{"start":{"line":402,"column":167,"offset":15765},"end":{"line":402,"column":283,"offset":15881}}}],"position":{"start":{"line":402,"column":1,"offset":15599},"end":{"line":402,"column":283,"offset":15881}}},{"type":"text","value":"\n"},{"type":"raw","value":"\n  <a class=\"gatsby-resp-image-link\" href=\"/static/d96fec10d250eace9756f09543bf5d58/00d43/implementation-notes-tree.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 840px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.904761904761905%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQoz5WS227jIBRF8/+fNuplFI1aJx6njh1uBzBgwNgGzChRq6p9qCZb53VJZ192wBjFVILwzqectryV/9Yu5SSFZIjtn/d1VQMlRg9xjcuyxpi2rdzuXd/hZV3IGyYvSLVqVuvqlIOTNWK0KlhXfvxjV0oJIQgpnLOzlXZ0wxC5mCmdOA9SzsZ4AHDOcc699yGEnPMnXEqxzg5KekXsODIICLnz2V4ujpBJa9/3ndYaE2ytdc59gRc7Q8PgL4RhjS7dEVgIgV6IwEK0SDZH2dZa0jd+6lVHDG5E3crTEapenZG+zMv83XPKiQtOGTG8F+2et3+a48Pv7vHAXo5Q7dHTc//w2P/iGlvoBnoGZsZxfIdzzhhhjDClrKpe60OFug44EEY5FzHFvKU1rdfGUswplo/arrCxhg9CaZXyHYav8KQn0hLS4En6u+Z1C0wH0xtZi6GR5T62/APNkrH3Qjpj7gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"React DevTools tree\" title src=\"/static/d96fec10d250eace9756f09543bf5d58/1e088/implementation-notes-tree.png\" srcset=\"/static/d96fec10d250eace9756f09543bf5d58/65ed1/implementation-notes-tree.png 210w,\n/static/d96fec10d250eace9756f09543bf5d58/d10fb/implementation-notes-tree.png 420w,\n/static/d96fec10d250eace9756f09543bf5d58/1e088/implementation-notes-tree.png 840w,\n/static/d96fec10d250eace9756f09543bf5d58/00d43/implementation-notes-tree.png 1000w\" sizes=\"(max-width: 840px) 100vw, 840px\">\n    </span>\n  </span>\n  \n  </a>\n    ","position":{"start":{"line":404,"column":1,"offset":15883},"end":{"line":404,"column":122,"offset":16004}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To complete this refactoring, we will introduce a function that mounts a complete tree into a container node and a public instance:","position":{"start":{"line":406,"column":1,"offset":16006},"end":{"line":406,"column":132,"offset":16137}}}],"position":{"start":{"line":406,"column":1,"offset":16006},"end":{"line":406,"column":132,"offset":16137}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element<span class=\"token punctuation\">,</span> containerNode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create the top-level internal instance</span>\n  <span class=\"token keyword\">var</span> rootComponent <span class=\"token operator\">=</span> <span class=\"token function\">instantiateComponent</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Mount the top-level component into the container</span>\n  <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> rootComponent<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  containerNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Return the public instance it provides</span>\n  <span class=\"token keyword\">var</span> publicInstance <span class=\"token operator\">=</span> rootComponent<span class=\"token punctuation\">.</span><span class=\"token function\">getPublicInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> publicInstance<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> rootEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> rootEl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":408,"column":1,"offset":16139},"end":{"line":424,"column":4,"offset":16621}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"unmounting"},"children":[{"type":"element","tagName":"a","properties":{"href":"#unmounting","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Unmounting ","position":{"start":{"line":426,"column":5,"offset":16627},"end":{"line":426,"column":29,"offset":16651}}}],"position":{"start":{"line":426,"column":1,"offset":16623},"end":{"line":426,"column":29,"offset":16651}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now that we have internal instances that hold onto their children and the DOM nodes, we can implement unmounting. For a composite component, unmounting calls a lifecycle method and recurses.","position":{"start":{"line":428,"column":1,"offset":16653},"end":{"line":428,"column":191,"offset":16843}}}],"position":{"start":{"line":428,"column":1,"offset":16653},"end":{"line":428,"column":191,"offset":16843}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CompositeComponent</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Call the lifecycle method if necessary</span>\n    <span class=\"token keyword\">var</span> publicInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>publicInstance<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicInstance<span class=\"token punctuation\">.</span>componentWillUnmount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Unmount the single rendered component</span>\n    <span class=\"token keyword\">var</span> renderedComponent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedComponent<span class=\"token punctuation\">;</span>\n    renderedComponent<span class=\"token punctuation\">.</span><span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":430,"column":1,"offset":16845},"end":{"line":449,"column":4,"offset":17271}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For ","position":{"start":{"line":451,"column":1,"offset":17273},"end":{"line":451,"column":5,"offset":17277}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":451,"column":5,"offset":17277},"end":{"line":451,"column":19,"offset":17291}}},{"type":"text","value":", unmounting tells each child to unmount:","position":{"start":{"line":451,"column":19,"offset":17291},"end":{"line":451,"column":60,"offset":17332}}}],"position":{"start":{"line":451,"column":1,"offset":17273},"end":{"line":451,"column":60,"offset":17332}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DOMComponent</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Unmount all the children</span>\n    <span class=\"token keyword\">var</span> renderedChildren <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedChildren<span class=\"token punctuation\">;</span>\n    renderedChildren<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">child</span> <span class=\"token operator\">=></span> child<span class=\"token punctuation\">.</span><span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":453,"column":1,"offset":17334},"end":{"line":464,"column":4,"offset":17533}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In practice, unmounting DOM components also removes the event listeners and clears some caches, but we will skip those details.","position":{"start":{"line":466,"column":1,"offset":17535},"end":{"line":466,"column":128,"offset":17662}}}],"position":{"start":{"line":466,"column":1,"offset":17535},"end":{"line":466,"column":128,"offset":17662}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can now add a new top-level function called ","position":{"start":{"line":468,"column":1,"offset":17664},"end":{"line":468,"column":48,"offset":17711}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">unmountTree(containerNode)</code>","position":{"start":{"line":468,"column":48,"offset":17711},"end":{"line":468,"column":76,"offset":17739}}},{"type":"text","value":" that is similar to ","position":{"start":{"line":468,"column":76,"offset":17739},"end":{"line":468,"column":96,"offset":17759}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactDOM.unmountComponentAtNode()</code>","position":{"start":{"line":468,"column":96,"offset":17759},"end":{"line":468,"column":131,"offset":17794}}},{"type":"text","value":":","position":{"start":{"line":468,"column":131,"offset":17794},"end":{"line":468,"column":132,"offset":17795}}}],"position":{"start":{"line":468,"column":1,"offset":17664},"end":{"line":468,"column":132,"offset":17795}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">unmountTree</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">containerNode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Read the internal instance from a DOM node:</span>\n  <span class=\"token comment\">// (This doesn't work yet, we will need to change mountTree() to store it.)</span>\n  <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> containerNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> rootComponent <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>_internalInstance<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Unmount the tree and clear the container</span>\n  rootComponent<span class=\"token punctuation\">.</span><span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  containerNode<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":470,"column":1,"offset":17797},"end":{"line":481,"column":4,"offset":18164}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In order for this to work, we need to read an internal root instance from a DOM node. We will modify ","position":{"start":{"line":483,"column":1,"offset":18166},"end":{"line":483,"column":102,"offset":18267}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountTree()</code>","position":{"start":{"line":483,"column":102,"offset":18267},"end":{"line":483,"column":115,"offset":18280}}},{"type":"text","value":" to add the ","position":{"start":{"line":483,"column":115,"offset":18280},"end":{"line":483,"column":127,"offset":18292}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">_internalInstance</code>","position":{"start":{"line":483,"column":127,"offset":18292},"end":{"line":483,"column":146,"offset":18311}}},{"type":"text","value":" property to the root DOM node. We will also teach ","position":{"start":{"line":483,"column":146,"offset":18311},"end":{"line":483,"column":197,"offset":18362}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountTree()</code>","position":{"start":{"line":483,"column":197,"offset":18362},"end":{"line":483,"column":210,"offset":18375}}},{"type":"text","value":" to destroy any existing tree so it can be called multiple times:","position":{"start":{"line":483,"column":210,"offset":18375},"end":{"line":483,"column":275,"offset":18440}}}],"position":{"start":{"line":483,"column":1,"offset":18166},"end":{"line":483,"column":275,"offset":18440}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element<span class=\"token punctuation\">,</span> containerNode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Destroy any existing tree</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containerNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">unmountTree</span><span class=\"token punctuation\">(</span>containerNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Create the top-level internal instance</span>\n  <span class=\"token keyword\">var</span> rootComponent <span class=\"token operator\">=</span> <span class=\"token function\">instantiateComponent</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Mount the top-level component into the container</span>\n  <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> rootComponent<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  containerNode<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Save a reference to the internal instance</span>\n  node<span class=\"token punctuation\">.</span>_internalInstance <span class=\"token operator\">=</span> rootComponent<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Return the public instance it provides</span>\n  <span class=\"token keyword\">var</span> publicInstance <span class=\"token operator\">=</span> rootComponent<span class=\"token punctuation\">.</span><span class=\"token function\">getPublicInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> publicInstance<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":485,"column":1,"offset":18442},"end":{"line":506,"column":4,"offset":19041}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now, running ","position":{"start":{"line":508,"column":1,"offset":19043},"end":{"line":508,"column":14,"offset":19056}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">unmountTree()</code>","position":{"start":{"line":508,"column":14,"offset":19056},"end":{"line":508,"column":29,"offset":19071}}},{"type":"text","value":", or running ","position":{"start":{"line":508,"column":29,"offset":19071},"end":{"line":508,"column":42,"offset":19084}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountTree()</code>","position":{"start":{"line":508,"column":42,"offset":19084},"end":{"line":508,"column":55,"offset":19097}}},{"type":"text","value":" repeatedly, removes the old tree and runs the ","position":{"start":{"line":508,"column":55,"offset":19097},"end":{"line":508,"column":102,"offset":19144}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">componentWillUnmount()</code>","position":{"start":{"line":508,"column":102,"offset":19144},"end":{"line":508,"column":126,"offset":19168}}},{"type":"text","value":" lifecycle method on components.","position":{"start":{"line":508,"column":126,"offset":19168},"end":{"line":508,"column":158,"offset":19200}}}],"position":{"start":{"line":508,"column":1,"offset":19043},"end":{"line":508,"column":158,"offset":19200}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"updating"},"children":[{"type":"element","tagName":"a","properties":{"href":"#updating","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Updating ","position":{"start":{"line":510,"column":5,"offset":19206},"end":{"line":510,"column":25,"offset":19226}}}],"position":{"start":{"line":510,"column":1,"offset":19202},"end":{"line":510,"column":25,"offset":19226}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the previous section, we implemented unmounting. However React wouldn’t be very useful if each prop change unmounted and mounted the whole tree. The goal of the reconciler is to reuse existing instances where possible to preserve the DOM and the state:","position":{"start":{"line":512,"column":1,"offset":19228},"end":{"line":512,"column":256,"offset":19483}}}],"position":{"start":{"line":512,"column":1,"offset":19228},"end":{"line":512,"column":256,"offset":19483}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">var</span> rootEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> rootEl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Should reuse the existing DOM:</span>\n<span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> rootEl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":514,"column":1,"offset":19485},"end":{"line":520,"column":4,"offset":19631}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We will extend our internal instance contract with one more method. In addition to ","position":{"start":{"line":522,"column":1,"offset":19633},"end":{"line":522,"column":84,"offset":19716}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mount()</code>","position":{"start":{"line":522,"column":84,"offset":19716},"end":{"line":522,"column":93,"offset":19725}}},{"type":"text","value":" and ","position":{"start":{"line":522,"column":93,"offset":19725},"end":{"line":522,"column":98,"offset":19730}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">unmount()</code>","position":{"start":{"line":522,"column":98,"offset":19730},"end":{"line":522,"column":109,"offset":19741}}},{"type":"text","value":", both ","position":{"start":{"line":522,"column":109,"offset":19741},"end":{"line":522,"column":116,"offset":19748}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":522,"column":116,"offset":19748},"end":{"line":522,"column":130,"offset":19762}}},{"type":"text","value":" and ","position":{"start":{"line":522,"column":130,"offset":19762},"end":{"line":522,"column":135,"offset":19767}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":522,"column":135,"offset":19767},"end":{"line":522,"column":155,"offset":19787}}},{"type":"text","value":" will implement a new method called ","position":{"start":{"line":522,"column":155,"offset":19787},"end":{"line":522,"column":191,"offset":19823}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">receive(nextElement)</code>","position":{"start":{"line":522,"column":191,"offset":19823},"end":{"line":522,"column":213,"offset":19845}}},{"type":"text","value":":","position":{"start":{"line":522,"column":213,"offset":19845},"end":{"line":522,"column":214,"offset":19846}}}],"position":{"start":{"line":522,"column":1,"offset":19633},"end":{"line":522,"column":214,"offset":19846}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CompositeComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">receive</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nextElement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DOMComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">receive</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nextElement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":524,"column":1,"offset":19848},"end":{"line":540,"column":4,"offset":20010}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Its job is to do whatever is necessary to bring the component (and any of its children) up to date with the description provided by the ","position":{"start":{"line":542,"column":1,"offset":20012},"end":{"line":542,"column":137,"offset":20148}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">nextElement</code>","position":{"start":{"line":542,"column":137,"offset":20148},"end":{"line":542,"column":150,"offset":20161}}},{"type":"text","value":".","position":{"start":{"line":542,"column":150,"offset":20161},"end":{"line":542,"column":151,"offset":20162}}}],"position":{"start":{"line":542,"column":1,"offset":20012},"end":{"line":542,"column":151,"offset":20162}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is the part that is often described as “virtual DOM diffing” although what really happens is that we walk the internal tree recursively and let each internal instance receive an update.","position":{"start":{"line":544,"column":1,"offset":20164},"end":{"line":544,"column":191,"offset":20354}}}],"position":{"start":{"line":544,"column":1,"offset":20164},"end":{"line":544,"column":191,"offset":20354}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"updating-composite-components"},"children":[{"type":"element","tagName":"a","properties":{"href":"#updating-composite-components","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Updating Composite Components ","position":{"start":{"line":546,"column":5,"offset":20360},"end":{"line":546,"column":67,"offset":20422}}}],"position":{"start":{"line":546,"column":1,"offset":20356},"end":{"line":546,"column":67,"offset":20422}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When a composite component receives a new element, we run the ","position":{"start":{"line":548,"column":1,"offset":20424},"end":{"line":548,"column":63,"offset":20486}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">componentWillUpdate()</code>","position":{"start":{"line":548,"column":63,"offset":20486},"end":{"line":548,"column":86,"offset":20509}}},{"type":"text","value":" lifecycle method.","position":{"start":{"line":548,"column":86,"offset":20509},"end":{"line":548,"column":104,"offset":20527}}}],"position":{"start":{"line":548,"column":1,"offset":20424},"end":{"line":548,"column":104,"offset":20527}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then we re-render the component with the new props, and get the next rendered element:","position":{"start":{"line":550,"column":1,"offset":20529},"end":{"line":550,"column":87,"offset":20615}}}],"position":{"start":{"line":550,"column":1,"offset":20529},"end":{"line":550,"column":87,"offset":20615}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CompositeComponent</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">receive</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nextElement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> prevProps <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> publicInstance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>publicInstance<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> prevRenderedComponent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedComponent<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> prevRenderedElement <span class=\"token operator\">=</span> prevRenderedComponent<span class=\"token punctuation\">.</span>currentElement<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Update *own* element</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement <span class=\"token operator\">=</span> nextElement<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> type <span class=\"token operator\">=</span> nextElement<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> nextProps <span class=\"token operator\">=</span> nextElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Figure out what the next render() output is</span>\n    <span class=\"token keyword\">var</span> nextRenderedElement<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isClass</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Component class</span>\n      <span class=\"token comment\">// Call the lifecycle if necessary</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicInstance<span class=\"token punctuation\">.</span>componentWillUpdate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">componentWillUpdate</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// Update the props</span>\n      publicInstance<span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> nextProps<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Re-render</span>\n      nextRenderedElement <span class=\"token operator\">=</span> publicInstance<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> type <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Component function</span>\n      nextRenderedElement <span class=\"token operator\">=</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ...</span></code></pre></div>","position":{"start":{"line":552,"column":1,"offset":20617},"end":{"line":586,"column":4,"offset":21603}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next, we can look at the rendered element’s ","position":{"start":{"line":588,"column":1,"offset":21605},"end":{"line":588,"column":45,"offset":21649}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">type</code>","position":{"start":{"line":588,"column":45,"offset":21649},"end":{"line":588,"column":51,"offset":21655}}},{"type":"text","value":". If the ","position":{"start":{"line":588,"column":51,"offset":21655},"end":{"line":588,"column":60,"offset":21664}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">type</code>","position":{"start":{"line":588,"column":60,"offset":21664},"end":{"line":588,"column":66,"offset":21670}}},{"type":"text","value":" has not changed since the last render, the component below can also be updated in place.","position":{"start":{"line":588,"column":66,"offset":21670},"end":{"line":588,"column":155,"offset":21759}}}],"position":{"start":{"line":588,"column":1,"offset":21605},"end":{"line":588,"column":155,"offset":21759}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For example, if it returned ","position":{"start":{"line":590,"column":1,"offset":21761},"end":{"line":590,"column":29,"offset":21789}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;Button color=\"red\" /></code>","position":{"start":{"line":590,"column":29,"offset":21789},"end":{"line":590,"column":53,"offset":21813}}},{"type":"text","value":" the first time, and ","position":{"start":{"line":590,"column":53,"offset":21813},"end":{"line":590,"column":74,"offset":21834}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;Button color=\"blue\" /></code>","position":{"start":{"line":590,"column":74,"offset":21834},"end":{"line":590,"column":99,"offset":21859}}},{"type":"text","value":" the second time, we can just tell the corresponding internal instance to ","position":{"start":{"line":590,"column":99,"offset":21859},"end":{"line":590,"column":173,"offset":21933}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">receive()</code>","position":{"start":{"line":590,"column":173,"offset":21933},"end":{"line":590,"column":184,"offset":21944}}},{"type":"text","value":" the next element:","position":{"start":{"line":590,"column":184,"offset":21944},"end":{"line":590,"column":202,"offset":21962}}}],"position":{"start":{"line":590,"column":1,"offset":21761},"end":{"line":590,"column":202,"offset":21962}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\">    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">// If the rendered element type has not changed,</span>\n    <span class=\"token comment\">// reuse the existing component instance and exit.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prevRenderedElement<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> nextRenderedElement<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      prevRenderedComponent<span class=\"token punctuation\">.</span><span class=\"token function\">receive</span><span class=\"token punctuation\">(</span>nextRenderedElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ...</span></code></pre></div>","position":{"start":{"line":592,"column":1,"offset":21964},"end":{"line":603,"column":4,"offset":22248}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However, if the next rendered element has a different ","position":{"start":{"line":605,"column":1,"offset":22250},"end":{"line":605,"column":55,"offset":22304}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">type</code>","position":{"start":{"line":605,"column":55,"offset":22304},"end":{"line":605,"column":61,"offset":22310}}},{"type":"text","value":" than the previously rendered element, we can’t update the internal instance. A ","position":{"start":{"line":605,"column":61,"offset":22310},"end":{"line":605,"column":141,"offset":22390}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;button></code>","position":{"start":{"line":605,"column":141,"offset":22390},"end":{"line":605,"column":151,"offset":22400}}},{"type":"text","value":" can’t “become” an ","position":{"start":{"line":605,"column":151,"offset":22400},"end":{"line":605,"column":170,"offset":22419}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;input></code>","position":{"start":{"line":605,"column":170,"offset":22419},"end":{"line":605,"column":179,"offset":22428}}},{"type":"text","value":".","position":{"start":{"line":605,"column":179,"offset":22428},"end":{"line":605,"column":180,"offset":22429}}}],"position":{"start":{"line":605,"column":1,"offset":22250},"end":{"line":605,"column":180,"offset":22429}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Instead, we have to unmount the existing internal instance and mount the new one corresponding to the rendered element type. For example, this is what happens when a component that previously rendered a ","position":{"start":{"line":607,"column":1,"offset":22431},"end":{"line":607,"column":204,"offset":22634}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;button /></code>","position":{"start":{"line":607,"column":204,"offset":22634},"end":{"line":607,"column":216,"offset":22646}}},{"type":"text","value":" renders an ","position":{"start":{"line":607,"column":216,"offset":22646},"end":{"line":607,"column":228,"offset":22658}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">&lt;input /></code>","position":{"start":{"line":607,"column":228,"offset":22658},"end":{"line":607,"column":239,"offset":22669}}},{"type":"text","value":":","position":{"start":{"line":607,"column":239,"offset":22669},"end":{"line":607,"column":240,"offset":22670}}}],"position":{"start":{"line":607,"column":1,"offset":22431},"end":{"line":607,"column":240,"offset":22670}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\">    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">// If we reached this point, we need to unmount the previously</span>\n    <span class=\"token comment\">// mounted component, mount the new one, and swap their nodes.</span>\n\n    <span class=\"token comment\">// Find the old node because it will need to be replaced</span>\n    <span class=\"token keyword\">var</span> prevNode <span class=\"token operator\">=</span> prevRenderedComponent<span class=\"token punctuation\">.</span><span class=\"token function\">getHostNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Unmount the old child and mount a new child</span>\n    prevRenderedComponent<span class=\"token punctuation\">.</span><span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> nextRenderedComponent <span class=\"token operator\">=</span> <span class=\"token function\">instantiateComponent</span><span class=\"token punctuation\">(</span>nextRenderedElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> nextNode <span class=\"token operator\">=</span> nextRenderedComponent<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Replace the reference to the child</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedComponent <span class=\"token operator\">=</span> nextRenderedComponent<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Replace the old node with the new one</span>\n    <span class=\"token comment\">// Note: this is renderer-specific code and</span>\n    <span class=\"token comment\">// ideally should live outside of CompositeComponent:</span>\n    prevNode<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>nextNode<span class=\"token punctuation\">,</span> prevNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":609,"column":1,"offset":22672},"end":{"line":632,"column":4,"offset":23470}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To sum this up, when a composite component receives a new element, it may either delegate the update to its rendered internal instance, or unmount it and mount a new one in its place.","position":{"start":{"line":634,"column":1,"offset":23472},"end":{"line":634,"column":184,"offset":23655}}}],"position":{"start":{"line":634,"column":1,"offset":23472},"end":{"line":634,"column":184,"offset":23655}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is another condition under which a component will re-mount rather than receive an element, and that is when the element’s ","position":{"start":{"line":636,"column":1,"offset":23657},"end":{"line":636,"column":129,"offset":23785}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">key</code>","position":{"start":{"line":636,"column":129,"offset":23785},"end":{"line":636,"column":134,"offset":23790}}},{"type":"text","value":" has changed. We don’t discuss ","position":{"start":{"line":636,"column":134,"offset":23790},"end":{"line":636,"column":165,"offset":23821}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">key</code>","position":{"start":{"line":636,"column":165,"offset":23821},"end":{"line":636,"column":170,"offset":23826}}},{"type":"text","value":" handling in this document because it adds more complexity to an already complex tutorial.","position":{"start":{"line":636,"column":170,"offset":23826},"end":{"line":636,"column":260,"offset":23916}}}],"position":{"start":{"line":636,"column":1,"offset":23657},"end":{"line":636,"column":260,"offset":23916}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that we needed to add a method called ","position":{"start":{"line":638,"column":1,"offset":23918},"end":{"line":638,"column":44,"offset":23961}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">getHostNode()</code>","position":{"start":{"line":638,"column":44,"offset":23961},"end":{"line":638,"column":59,"offset":23976}}},{"type":"text","value":" to the internal instance contract so that it’s possible to locate the platform-specific node and replace it during the update. Its implementation is straightforward for both classes:","position":{"start":{"line":638,"column":59,"offset":23976},"end":{"line":638,"column":242,"offset":24159}}}],"position":{"start":{"line":638,"column":1,"offset":23918},"end":{"line":638,"column":242,"offset":24159}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CompositeComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">getHostNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Ask the rendered component to provide it.</span>\n    <span class=\"token comment\">// This will recursively drill down any composites.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedComponent<span class=\"token punctuation\">.</span><span class=\"token function\">getHostNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DOMComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">getHostNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":640,"column":1,"offset":24161},"end":{"line":658,"column":4,"offset":24465}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"updating-host-components"},"children":[{"type":"element","tagName":"a","properties":{"href":"#updating-host-components","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Updating Host Components ","position":{"start":{"line":660,"column":5,"offset":24471},"end":{"line":660,"column":57,"offset":24523}}}],"position":{"start":{"line":660,"column":1,"offset":24467},"end":{"line":660,"column":57,"offset":24523}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Host component implementations, such as ","position":{"start":{"line":662,"column":1,"offset":24525},"end":{"line":662,"column":41,"offset":24565}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":662,"column":41,"offset":24565},"end":{"line":662,"column":55,"offset":24579}}},{"type":"text","value":", update differently. When they receive an element, they need to update the underlying platform-specific view. In case of React DOM, this means updating the DOM attributes:","position":{"start":{"line":662,"column":55,"offset":24579},"end":{"line":662,"column":227,"offset":24751}}}],"position":{"start":{"line":662,"column":1,"offset":24525},"end":{"line":662,"column":227,"offset":24751}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DOMComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">receive</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nextElement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> prevElement <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> prevProps <span class=\"token operator\">=</span> prevElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> nextProps <span class=\"token operator\">=</span> nextElement<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>    \n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentElement <span class=\"token operator\">=</span> nextElement<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Remove old attributes.</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>prevProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">propName</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propName <span class=\"token operator\">!==</span> <span class=\"token string\">'children'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>nextProps<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span>propName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        node<span class=\"token punctuation\">.</span><span class=\"token function\">removeAttribute</span><span class=\"token punctuation\">(</span>propName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Set next attributes.</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>nextProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">propName</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propName <span class=\"token operator\">!==</span> <span class=\"token string\">'children'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        node<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span>propName<span class=\"token punctuation\">,</span> nextProps<span class=\"token punctuation\">[</span>propName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span></code></pre></div>","position":{"start":{"line":664,"column":1,"offset":24753},"end":{"line":689,"column":4,"offset":25420}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then, host components need to update their children. Unlike composite components, they might contain more than a single child.","position":{"start":{"line":691,"column":1,"offset":25422},"end":{"line":691,"column":127,"offset":25548}}}],"position":{"start":{"line":691,"column":1,"offset":25422},"end":{"line":691,"column":127,"offset":25548}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In this simplified example, we use an array of internal instances and iterate over it, either updating or replacing the internal instances depending on whether the received ","position":{"start":{"line":693,"column":1,"offset":25550},"end":{"line":693,"column":174,"offset":25723}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">type</code>","position":{"start":{"line":693,"column":174,"offset":25723},"end":{"line":693,"column":180,"offset":25729}}},{"type":"text","value":" matches their previous ","position":{"start":{"line":693,"column":180,"offset":25729},"end":{"line":693,"column":204,"offset":25753}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">type</code>","position":{"start":{"line":693,"column":204,"offset":25753},"end":{"line":693,"column":210,"offset":25759}}},{"type":"text","value":". The real reconciler also takes element’s ","position":{"start":{"line":693,"column":210,"offset":25759},"end":{"line":693,"column":253,"offset":25802}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">key</code>","position":{"start":{"line":693,"column":253,"offset":25802},"end":{"line":693,"column":258,"offset":25807}}},{"type":"text","value":" in the account and track moves in addition to insertions and deletions, but we will omit this logic.","position":{"start":{"line":693,"column":258,"offset":25807},"end":{"line":693,"column":359,"offset":25908}}}],"position":{"start":{"line":693,"column":1,"offset":25550},"end":{"line":693,"column":359,"offset":25908}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We collect DOM operations on children in a list so we can execute them in batch:","position":{"start":{"line":695,"column":1,"offset":25910},"end":{"line":695,"column":81,"offset":25990}}}],"position":{"start":{"line":695,"column":1,"offset":25910},"end":{"line":695,"column":81,"offset":25990}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\">    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">// These are arrays of React elements:</span>\n    <span class=\"token keyword\">var</span> prevChildren <span class=\"token operator\">=</span> prevProps<span class=\"token punctuation\">.</span>children <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>prevChildren<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      prevChildren <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>prevChildren<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> nextChildren <span class=\"token operator\">=</span> nextProps<span class=\"token punctuation\">.</span>children <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>nextChildren<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      nextChildren <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>nextChildren<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// These are arrays of internal instances:</span>\n    <span class=\"token keyword\">var</span> prevRenderedChildren <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedChildren<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> nextRenderedChildren <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// As we iterate over children, we will add operations to the array.</span>\n    <span class=\"token keyword\">var</span> operationQueue <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Note: the section below is extremely simplified!</span>\n    <span class=\"token comment\">// It doesn't handle reorders, children with holes, or keys.</span>\n    <span class=\"token comment\">// It only exists to illustrate the overall flow, not the specifics.</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> nextChildren<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Try to get an existing internal instance for this child</span>\n      <span class=\"token keyword\">var</span> prevChild <span class=\"token operator\">=</span> prevRenderedChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// If there is no internal instance under this index,</span>\n      <span class=\"token comment\">// a child has been appended to the end. Create a new</span>\n      <span class=\"token comment\">// internal instance, mount it, and use its node.</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>prevChild<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> nextChild <span class=\"token operator\">=</span> <span class=\"token function\">instantiateComponent</span><span class=\"token punctuation\">(</span>nextChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> nextChild<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Record that we need to append a node</span>\n        operationQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'ADD'</span><span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        nextRenderedChildren<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>nextChild<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// We can only update the instance if its element's type matches.</span>\n      <span class=\"token comment\">// For example, &lt;Button size=\"small\" /> can be updated to</span>\n      <span class=\"token comment\">// &lt;Button size=\"large\" /> but not to an &lt;App />.</span>\n      <span class=\"token keyword\">var</span> canUpdate <span class=\"token operator\">=</span> prevChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> nextChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// If we can't update an existing instance, we have to unmount it</span>\n      <span class=\"token comment\">// and mount a new one instead of it.</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>canUpdate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> prevNode <span class=\"token operator\">=</span> prevChild<span class=\"token punctuation\">.</span><span class=\"token function\">getHostNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        prevChild<span class=\"token punctuation\">.</span><span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">var</span> nextChild <span class=\"token operator\">=</span> <span class=\"token function\">instantiateComponent</span><span class=\"token punctuation\">(</span>nextChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> nextNode <span class=\"token operator\">=</span> nextChild<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Record that we need to swap the nodes</span>\n        operationQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'REPLACE'</span><span class=\"token punctuation\">,</span> prevNode<span class=\"token punctuation\">,</span> nextNode<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        nextRenderedChildren<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>nextChild<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// If we can update an existing internal instance,</span>\n      <span class=\"token comment\">// just let it receive the next element and handle its own update.</span>\n      prevChild<span class=\"token punctuation\">.</span><span class=\"token function\">receive</span><span class=\"token punctuation\">(</span>nextChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      nextRenderedChildren<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>prevChild<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Finally, unmount any children that don't exist:</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> j <span class=\"token operator\">=</span> nextChildren<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> prevChildren<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> prevChild <span class=\"token operator\">=</span> prevRenderedChildren<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> node <span class=\"token operator\">=</span> prevChild<span class=\"token punctuation\">.</span><span class=\"token function\">getHostNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      prevChild<span class=\"token punctuation\">.</span><span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Record that we need to remove the node</span>\n      operationQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'REMOVE'</span><span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Point the list of rendered children to the updated version.</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderedChildren <span class=\"token operator\">=</span> nextRenderedChildren<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span></code></pre></div>","position":{"start":{"line":697,"column":1,"offset":25992},"end":{"line":777,"column":4,"offset":28869}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As the last step, we execute the DOM operations. Again, the real reconciler code is more complex because it also handles moves:","position":{"start":{"line":779,"column":1,"offset":28871},"end":{"line":779,"column":128,"offset":28998}}}],"position":{"start":{"line":779,"column":1,"offset":28871},"end":{"line":779,"column":128,"offset":28998}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\">    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">// Process the operation queue.</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>operationQueue<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> operation <span class=\"token operator\">=</span> operationQueue<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>operation<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'ADD'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>operation<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'REPLACE'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>operation<span class=\"token punctuation\">.</span>nextNode<span class=\"token punctuation\">,</span> operation<span class=\"token punctuation\">.</span>prevNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'REMOVE'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>operation<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":781,"column":1,"offset":29000},"end":{"line":801,"column":4,"offset":29467}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And that is it for updating host components.","position":{"start":{"line":803,"column":1,"offset":29469},"end":{"line":803,"column":45,"offset":29513}}}],"position":{"start":{"line":803,"column":1,"offset":29469},"end":{"line":803,"column":45,"offset":29513}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"top-level-updates"},"children":[{"type":"element","tagName":"a","properties":{"href":"#top-level-updates","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Top-Level Updates ","position":{"start":{"line":805,"column":5,"offset":29519},"end":{"line":805,"column":43,"offset":29557}}}],"position":{"start":{"line":805,"column":1,"offset":29515},"end":{"line":805,"column":43,"offset":29557}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now that both ","position":{"start":{"line":807,"column":1,"offset":29559},"end":{"line":807,"column":15,"offset":29573}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":807,"column":15,"offset":29573},"end":{"line":807,"column":35,"offset":29593}}},{"type":"text","value":" and ","position":{"start":{"line":807,"column":35,"offset":29593},"end":{"line":807,"column":40,"offset":29598}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":807,"column":40,"offset":29598},"end":{"line":807,"column":54,"offset":29612}}},{"type":"text","value":" implement the ","position":{"start":{"line":807,"column":54,"offset":29612},"end":{"line":807,"column":69,"offset":29627}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">receive(nextElement)</code>","position":{"start":{"line":807,"column":69,"offset":29627},"end":{"line":807,"column":91,"offset":29649}}},{"type":"text","value":" method, we can change the top-level ","position":{"start":{"line":807,"column":91,"offset":29649},"end":{"line":807,"column":128,"offset":29686}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountTree()</code>","position":{"start":{"line":807,"column":128,"offset":29686},"end":{"line":807,"column":141,"offset":29699}}},{"type":"text","value":" function to use it when the element ","position":{"start":{"line":807,"column":141,"offset":29699},"end":{"line":807,"column":178,"offset":29736}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">type</code>","position":{"start":{"line":807,"column":178,"offset":29736},"end":{"line":807,"column":184,"offset":29742}}},{"type":"text","value":" is the same as it was the last time:","position":{"start":{"line":807,"column":184,"offset":29742},"end":{"line":807,"column":221,"offset":29779}}}],"position":{"start":{"line":807,"column":1,"offset":29559},"end":{"line":807,"column":221,"offset":29779}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element<span class=\"token punctuation\">,</span> containerNode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Check for an existing tree</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containerNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> prevNode <span class=\"token operator\">=</span> containerNode<span class=\"token punctuation\">.</span>firstChild<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> prevRootComponent <span class=\"token operator\">=</span> prevNode<span class=\"token punctuation\">.</span>_internalInstance<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> prevElement <span class=\"token operator\">=</span> prevRootComponent<span class=\"token punctuation\">.</span>currentElement<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If we can, reuse the existing root component</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prevElement<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      prevRootComponent<span class=\"token punctuation\">.</span><span class=\"token function\">receive</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Otherwise, unmount the existing tree</span>\n    <span class=\"token function\">unmountTree</span><span class=\"token punctuation\">(</span>containerNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// ...</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":809,"column":1,"offset":29781},"end":{"line":830,"column":4,"offset":30312}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now calling ","position":{"start":{"line":832,"column":1,"offset":30314},"end":{"line":832,"column":13,"offset":30326}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountTree()</code>","position":{"start":{"line":832,"column":13,"offset":30326},"end":{"line":832,"column":26,"offset":30339}}},{"type":"text","value":" two times with the same type isn’t destructive:","position":{"start":{"line":832,"column":26,"offset":30339},"end":{"line":832,"column":74,"offset":30387}}}],"position":{"start":{"line":832,"column":1,"offset":30314},"end":{"line":832,"column":74,"offset":30387}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">var</span> rootEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> rootEl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Reuses the existing DOM:</span>\n<span class=\"token function\">mountTree</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> rootEl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":834,"column":1,"offset":30389},"end":{"line":840,"column":4,"offset":30529}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"These are the basics of how React works internally.","position":{"start":{"line":842,"column":1,"offset":30531},"end":{"line":842,"column":52,"offset":30582}}}],"position":{"start":{"line":842,"column":1,"offset":30531},"end":{"line":842,"column":52,"offset":30582}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"what-we-left-out"},"children":[{"type":"element","tagName":"a","properties":{"href":"#what-we-left-out","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"What We Left Out ","position":{"start":{"line":844,"column":5,"offset":30588},"end":{"line":844,"column":41,"offset":30624}}}],"position":{"start":{"line":844,"column":1,"offset":30584},"end":{"line":844,"column":41,"offset":30624}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This document is simplified compared to the real codebase. There are a few important aspects we didn’t address:","position":{"start":{"line":846,"column":1,"offset":30626},"end":{"line":846,"column":112,"offset":30737}}}],"position":{"start":{"line":846,"column":1,"offset":30626},"end":{"line":846,"column":112,"offset":30737}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Components can render ","position":{"start":{"line":848,"column":3,"offset":30741},"end":{"line":848,"column":25,"offset":30763}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">null</code>","position":{"start":{"line":848,"column":25,"offset":30763},"end":{"line":848,"column":31,"offset":30769}}},{"type":"text","value":", and the reconciler can handle “empty slots” in arrays and rendered output.","position":{"start":{"line":848,"column":31,"offset":30769},"end":{"line":848,"column":107,"offset":30845}}}],"position":{"start":{"line":848,"column":1,"offset":30739},"end":{"line":849,"column":1,"offset":30846}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The reconciler also reads ","position":{"start":{"line":850,"column":3,"offset":30849},"end":{"line":850,"column":29,"offset":30875}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">key</code>","position":{"start":{"line":850,"column":29,"offset":30875},"end":{"line":850,"column":34,"offset":30880}}},{"type":"text","value":" from the elements, and uses it to establish which internal instance corresponds to which element in an array. A bulk of complexity in the actual React implementation is related to that.","position":{"start":{"line":850,"column":34,"offset":30880},"end":{"line":850,"column":220,"offset":31066}}}],"position":{"start":{"line":850,"column":1,"offset":30847},"end":{"line":851,"column":1,"offset":31067}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"In addition to composite and host internal instance classes, there are also classes for “text” and “empty” components. They represent text nodes and the “empty slots” you get by rendering ","position":{"start":{"line":852,"column":3,"offset":31070},"end":{"line":852,"column":191,"offset":31258}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">null</code>","position":{"start":{"line":852,"column":191,"offset":31258},"end":{"line":852,"column":197,"offset":31264}}},{"type":"text","value":".","position":{"start":{"line":852,"column":197,"offset":31264},"end":{"line":852,"column":198,"offset":31265}}}],"position":{"start":{"line":852,"column":1,"offset":31068},"end":{"line":853,"column":1,"offset":31266}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Renderers use ","position":{"start":{"line":854,"column":3,"offset":31269},"end":{"line":854,"column":17,"offset":31283}}},{"type":"element","tagName":"a","properties":{"href":"/docs/codebase-overview.html#dynamic-injection"},"children":[{"type":"text","value":"injection","position":{"start":{"line":854,"column":18,"offset":31284},"end":{"line":854,"column":27,"offset":31293}}}],"position":{"start":{"line":854,"column":17,"offset":31283},"end":{"line":854,"column":76,"offset":31342}}},{"type":"text","value":" to pass the host internal class to the reconciler. For example, React DOM tells the reconciler to use ","position":{"start":{"line":854,"column":76,"offset":31342},"end":{"line":854,"column":179,"offset":31445}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactDOMComponent</code>","position":{"start":{"line":854,"column":179,"offset":31445},"end":{"line":854,"column":198,"offset":31464}}},{"type":"text","value":" as the host internal instance implementation.","position":{"start":{"line":854,"column":198,"offset":31464},"end":{"line":854,"column":244,"offset":31510}}}],"position":{"start":{"line":854,"column":1,"offset":31267},"end":{"line":855,"column":1,"offset":31511}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The logic for updating the list of children is extracted into a mixin called ","position":{"start":{"line":856,"column":3,"offset":31514},"end":{"line":856,"column":80,"offset":31591}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactMultiChild</code>","position":{"start":{"line":856,"column":80,"offset":31591},"end":{"line":856,"column":97,"offset":31608}}},{"type":"text","value":" which is used by the host internal instance class implementations both in React DOM and React Native.","position":{"start":{"line":856,"column":97,"offset":31608},"end":{"line":856,"column":199,"offset":31710}}}],"position":{"start":{"line":856,"column":1,"offset":31512},"end":{"line":857,"column":1,"offset":31711}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The reconciler also implements support for ","position":{"start":{"line":858,"column":3,"offset":31714},"end":{"line":858,"column":46,"offset":31757}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">setState()</code>","position":{"start":{"line":858,"column":46,"offset":31757},"end":{"line":858,"column":58,"offset":31769}}},{"type":"text","value":" in composite components. Multiple updates inside event handlers get batched into a single update.","position":{"start":{"line":858,"column":58,"offset":31769},"end":{"line":858,"column":156,"offset":31867}}}],"position":{"start":{"line":858,"column":1,"offset":31712},"end":{"line":859,"column":1,"offset":31868}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The reconciler also takes care of attaching and detaching refs to composite components and host nodes.","position":{"start":{"line":860,"column":3,"offset":31871},"end":{"line":860,"column":105,"offset":31973}}}],"position":{"start":{"line":860,"column":1,"offset":31869},"end":{"line":861,"column":1,"offset":31974}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Lifecycle methods that are called after the DOM is ready, such as ","position":{"start":{"line":862,"column":3,"offset":31977},"end":{"line":862,"column":69,"offset":32043}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">componentDidMount()</code>","position":{"start":{"line":862,"column":69,"offset":32043},"end":{"line":862,"column":90,"offset":32064}}},{"type":"text","value":" and ","position":{"start":{"line":862,"column":90,"offset":32064},"end":{"line":862,"column":95,"offset":32069}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">componentDidUpdate()</code>","position":{"start":{"line":862,"column":95,"offset":32069},"end":{"line":862,"column":117,"offset":32091}}},{"type":"text","value":", get collected into “callback queues” and are executed in a single batch.","position":{"start":{"line":862,"column":117,"offset":32091},"end":{"line":862,"column":191,"offset":32165}}}],"position":{"start":{"line":862,"column":1,"offset":31975},"end":{"line":863,"column":1,"offset":32166}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"React puts information about the current update into an internal object called “transaction”. Transactions are useful for keeping track of the queue of pending lifecycle methods, the current DOM nesting for the warnings, and anything else that is “global” to a specific update. Transactions also ensure React “cleans everything up” after updates. For example, the transaction class provided by React DOM restores the input selection after any update.","position":{"start":{"line":864,"column":3,"offset":32169},"end":{"line":864,"column":453,"offset":32619}}}],"position":{"start":{"line":864,"column":1,"offset":32167},"end":{"line":864,"column":453,"offset":32619}}},{"type":"text","value":"\n"}],"position":{"start":{"line":848,"column":1,"offset":30739},"end":{"line":864,"column":453,"offset":32619}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"jumping-into-the-code"},"children":[{"type":"element","tagName":"a","properties":{"href":"#jumping-into-the-code","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Jumping into the Code ","position":{"start":{"line":866,"column":5,"offset":32625},"end":{"line":866,"column":51,"offset":32671}}}],"position":{"start":{"line":866,"column":1,"offset":32621},"end":{"line":866,"column":51,"offset":32671}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/dom/client/ReactMount.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactMount</code>","position":{"start":{"line":868,"column":4,"offset":32676},"end":{"line":868,"column":16,"offset":32688}}}],"position":{"start":{"line":868,"column":3,"offset":32675},"end":{"line":868,"column":137,"offset":32809}}},{"type":"text","value":" is where the code like ","position":{"start":{"line":868,"column":137,"offset":32809},"end":{"line":868,"column":161,"offset":32833}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountTree()</code>","position":{"start":{"line":868,"column":161,"offset":32833},"end":{"line":868,"column":174,"offset":32846}}},{"type":"text","value":" and ","position":{"start":{"line":868,"column":174,"offset":32846},"end":{"line":868,"column":179,"offset":32851}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">unmountTree()</code>","position":{"start":{"line":868,"column":179,"offset":32851},"end":{"line":868,"column":194,"offset":32866}}},{"type":"text","value":" from this tutorial lives. It takes care of mounting and unmounting top-level components. ","position":{"start":{"line":868,"column":194,"offset":32866},"end":{"line":868,"column":284,"offset":32956}}},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/native/ReactNativeMount.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactNativeMount</code>","position":{"start":{"line":868,"column":285,"offset":32957},"end":{"line":868,"column":303,"offset":32975}}}],"position":{"start":{"line":868,"column":284,"offset":32956},"end":{"line":868,"column":426,"offset":33098}}},{"type":"text","value":" is its React Native analog.","position":{"start":{"line":868,"column":426,"offset":33098},"end":{"line":868,"column":454,"offset":33126}}}],"position":{"start":{"line":868,"column":1,"offset":32673},"end":{"line":868,"column":454,"offset":33126}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/dom/shared/ReactDOMComponent.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactDOMComponent</code>","position":{"start":{"line":869,"column":4,"offset":33130},"end":{"line":869,"column":23,"offset":33149}}}],"position":{"start":{"line":869,"column":3,"offset":33129},"end":{"line":869,"column":151,"offset":33277}}},{"type":"text","value":" is the equivalent of ","position":{"start":{"line":869,"column":151,"offset":33277},"end":{"line":869,"column":173,"offset":33299}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">DOMComponent</code>","position":{"start":{"line":869,"column":173,"offset":33299},"end":{"line":869,"column":187,"offset":33313}}},{"type":"text","value":" in this tutorial. It implements the host component class for React DOM renderer. ","position":{"start":{"line":869,"column":187,"offset":33313},"end":{"line":869,"column":269,"offset":33395}}},{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/native/ReactNativeBaseComponent.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactNativeBaseComponent</code>","position":{"start":{"line":869,"column":270,"offset":33396},"end":{"line":869,"column":296,"offset":33422}}}],"position":{"start":{"line":869,"column":269,"offset":33395},"end":{"line":869,"column":427,"offset":33553}}},{"type":"text","value":" is its React Native analog.","position":{"start":{"line":869,"column":427,"offset":33553},"end":{"line":869,"column":455,"offset":33581}}}],"position":{"start":{"line":869,"column":1,"offset":33127},"end":{"line":869,"column":455,"offset":33581}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/shared/stack/reconciler/ReactCompositeComponent.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactCompositeComponent</code>","position":{"start":{"line":870,"column":4,"offset":33585},"end":{"line":870,"column":29,"offset":33610}}}],"position":{"start":{"line":870,"column":3,"offset":33584},"end":{"line":870,"column":176,"offset":33757}}},{"type":"text","value":" is the equivalent of ","position":{"start":{"line":870,"column":176,"offset":33757},"end":{"line":870,"column":198,"offset":33779}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">CompositeComponent</code>","position":{"start":{"line":870,"column":198,"offset":33779},"end":{"line":870,"column":218,"offset":33799}}},{"type":"text","value":" in this tutorial. It handles calling user-defined components and maintaining their state.","position":{"start":{"line":870,"column":218,"offset":33799},"end":{"line":870,"column":308,"offset":33889}}}],"position":{"start":{"line":870,"column":1,"offset":33582},"end":{"line":870,"column":308,"offset":33889}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/shared/stack/reconciler/instantiateReactComponent.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">instantiateReactComponent</code>","position":{"start":{"line":871,"column":4,"offset":33893},"end":{"line":871,"column":31,"offset":33920}}}],"position":{"start":{"line":871,"column":3,"offset":33892},"end":{"line":871,"column":180,"offset":34069}}},{"type":"text","value":" contains the switch that picks the right internal instance class to construct for an element. It is equivalent to ","position":{"start":{"line":871,"column":180,"offset":34069},"end":{"line":871,"column":295,"offset":34184}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">instantiateComponent()</code>","position":{"start":{"line":871,"column":295,"offset":34184},"end":{"line":871,"column":319,"offset":34208}}},{"type":"text","value":" in this tutorial.","position":{"start":{"line":871,"column":319,"offset":34208},"end":{"line":871,"column":337,"offset":34226}}}],"position":{"start":{"line":871,"column":1,"offset":33890},"end":{"line":872,"column":1,"offset":34227}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/shared/stack/reconciler/ReactReconciler.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactReconciler</code>","position":{"start":{"line":873,"column":4,"offset":34231},"end":{"line":873,"column":21,"offset":34248}}}],"position":{"start":{"line":873,"column":3,"offset":34230},"end":{"line":873,"column":160,"offset":34387}}},{"type":"text","value":" is a wrapper with ","position":{"start":{"line":873,"column":160,"offset":34387},"end":{"line":873,"column":179,"offset":34406}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountComponent()</code>","position":{"start":{"line":873,"column":179,"offset":34406},"end":{"line":873,"column":197,"offset":34424}}},{"type":"text","value":", ","position":{"start":{"line":873,"column":197,"offset":34424},"end":{"line":873,"column":199,"offset":34426}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">receiveComponent()</code>","position":{"start":{"line":873,"column":199,"offset":34426},"end":{"line":873,"column":219,"offset":34446}}},{"type":"text","value":", and ","position":{"start":{"line":873,"column":219,"offset":34446},"end":{"line":873,"column":225,"offset":34452}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">unmountComponent()</code>","position":{"start":{"line":873,"column":225,"offset":34452},"end":{"line":873,"column":245,"offset":34472}}},{"type":"text","value":" methods. It calls the underlying implementations on the internal instances, but also includes some code around them that is shared by all internal instance implementations.","position":{"start":{"line":873,"column":245,"offset":34472},"end":{"line":873,"column":418,"offset":34645}}}],"position":{"start":{"line":873,"column":1,"offset":34228},"end":{"line":874,"column":1,"offset":34646}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/shared/stack/reconciler/ReactChildReconciler.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactChildReconciler</code>","position":{"start":{"line":875,"column":4,"offset":34650},"end":{"line":875,"column":26,"offset":34672}}}],"position":{"start":{"line":875,"column":3,"offset":34649},"end":{"line":875,"column":170,"offset":34816}}},{"type":"text","value":" implements the logic for mounting, updating, and unmounting children according to the ","position":{"start":{"line":875,"column":170,"offset":34816},"end":{"line":875,"column":257,"offset":34903}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">key</code>","position":{"start":{"line":875,"column":257,"offset":34903},"end":{"line":875,"column":262,"offset":34908}}},{"type":"text","value":" of their elements.","position":{"start":{"line":875,"column":262,"offset":34908},"end":{"line":875,"column":281,"offset":34927}}}],"position":{"start":{"line":875,"column":1,"offset":34647},"end":{"line":876,"column":1,"offset":34928}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/facebook/react/blob/83381c1673d14cd16cf747e34c945291e5518a86/src/renderers/shared/stack/reconciler/ReactMultiChild.js","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">ReactMultiChild</code>","position":{"start":{"line":877,"column":4,"offset":34932},"end":{"line":877,"column":21,"offset":34949}}}],"position":{"start":{"line":877,"column":3,"offset":34931},"end":{"line":877,"column":160,"offset":35088}}},{"type":"text","value":" implements processing the operation queue for child insertions, deletions, and moves independently of the renderer.","position":{"start":{"line":877,"column":160,"offset":35088},"end":{"line":877,"column":276,"offset":35204}}}],"position":{"start":{"line":877,"column":1,"offset":34929},"end":{"line":878,"column":1,"offset":35205}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"gatsby-code-text\">mount()</code>","position":{"start":{"line":879,"column":3,"offset":35208},"end":{"line":879,"column":12,"offset":35217}}},{"type":"text","value":", ","position":{"start":{"line":879,"column":12,"offset":35217},"end":{"line":879,"column":14,"offset":35219}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">receive()</code>","position":{"start":{"line":879,"column":14,"offset":35219},"end":{"line":879,"column":25,"offset":35230}}},{"type":"text","value":", and ","position":{"start":{"line":879,"column":25,"offset":35230},"end":{"line":879,"column":31,"offset":35236}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">unmount()</code>","position":{"start":{"line":879,"column":31,"offset":35236},"end":{"line":879,"column":42,"offset":35247}}},{"type":"text","value":" are really called ","position":{"start":{"line":879,"column":42,"offset":35247},"end":{"line":879,"column":61,"offset":35266}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">mountComponent()</code>","position":{"start":{"line":879,"column":61,"offset":35266},"end":{"line":879,"column":79,"offset":35284}}},{"type":"text","value":", ","position":{"start":{"line":879,"column":79,"offset":35284},"end":{"line":879,"column":81,"offset":35286}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">receiveComponent()</code>","position":{"start":{"line":879,"column":81,"offset":35286},"end":{"line":879,"column":101,"offset":35306}}},{"type":"text","value":", and ","position":{"start":{"line":879,"column":101,"offset":35306},"end":{"line":879,"column":107,"offset":35312}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">unmountComponent()</code>","position":{"start":{"line":879,"column":107,"offset":35312},"end":{"line":879,"column":127,"offset":35332}}},{"type":"text","value":" in React codebase for legacy reasons, but they receive elements.","position":{"start":{"line":879,"column":127,"offset":35332},"end":{"line":879,"column":192,"offset":35397}}}],"position":{"start":{"line":879,"column":1,"offset":35206},"end":{"line":880,"column":1,"offset":35398}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Properties on the internal instances start with an underscore, e.g. ","position":{"start":{"line":881,"column":3,"offset":35401},"end":{"line":881,"column":71,"offset":35469}}},{"type":"raw","value":"<code class=\"gatsby-code-text\">_currentElement</code>","position":{"start":{"line":881,"column":71,"offset":35469},"end":{"line":881,"column":88,"offset":35486}}},{"type":"text","value":". They are considered to be read-only public fields throughout the codebase.","position":{"start":{"line":881,"column":88,"offset":35486},"end":{"line":881,"column":164,"offset":35562}}}],"position":{"start":{"line":881,"column":1,"offset":35399},"end":{"line":881,"column":164,"offset":35562}}},{"type":"text","value":"\n"}],"position":{"start":{"line":868,"column":1,"offset":32673},"end":{"line":881,"column":164,"offset":35562}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"future-directions"},"children":[{"type":"element","tagName":"a","properties":{"href":"#future-directions","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Future Directions ","position":{"start":{"line":883,"column":5,"offset":35568},"end":{"line":883,"column":43,"offset":35606}}}],"position":{"start":{"line":883,"column":1,"offset":35564},"end":{"line":883,"column":43,"offset":35606}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Stack reconciler has inherent limitations such as being synchronous and unable to interrupt the work or split it in chunks. There is a work in progress on the ","position":{"start":{"line":885,"column":1,"offset":35608},"end":{"line":885,"column":160,"offset":35767}}},{"type":"element","tagName":"a","properties":{"href":"/docs/codebase-overview.html#fiber-reconciler"},"children":[{"type":"text","value":"new Fiber reconciler","position":{"start":{"line":885,"column":161,"offset":35768},"end":{"line":885,"column":181,"offset":35788}}}],"position":{"start":{"line":885,"column":160,"offset":35767},"end":{"line":885,"column":229,"offset":35836}}},{"type":"text","value":" with a ","position":{"start":{"line":885,"column":229,"offset":35836},"end":{"line":885,"column":237,"offset":35844}}},{"type":"element","tagName":"a","properties":{"href":"https://github.com/acdlite/react-fiber-architecture","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"completely different architecture","position":{"start":{"line":885,"column":238,"offset":35845},"end":{"line":885,"column":271,"offset":35878}}}],"position":{"start":{"line":885,"column":237,"offset":35844},"end":{"line":885,"column":325,"offset":35932}}},{"type":"text","value":". In the future, we intend to replace stack reconciler with it, but at the moment it is far from feature parity.","position":{"start":{"line":885,"column":325,"offset":35932},"end":{"line":885,"column":437,"offset":36044}}}],"position":{"start":{"line":885,"column":1,"offset":35608},"end":{"line":885,"column":437,"offset":36044}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"next-steps"},"children":[{"type":"element","tagName":"a","properties":{"href":"#next-steps","aria-hidden":true,"class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Next Steps ","position":{"start":{"line":887,"column":5,"offset":36050},"end":{"line":887,"column":29,"offset":36074}}}],"position":{"start":{"line":887,"column":1,"offset":36046},"end":{"line":887,"column":29,"offset":36074}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Read the ","position":{"start":{"line":889,"column":1,"offset":36076},"end":{"line":889,"column":10,"offset":36085}}},{"type":"element","tagName":"a","properties":{"href":"/docs/design-principles.html"},"children":[{"type":"text","value":"next section","position":{"start":{"line":889,"column":11,"offset":36086},"end":{"line":889,"column":23,"offset":36098}}}],"position":{"start":{"line":889,"column":10,"offset":36085},"end":{"line":889,"column":54,"offset":36129}}},{"type":"text","value":" to learn about the guiding principles we use for React development.","position":{"start":{"line":889,"column":54,"offset":36129},"end":{"line":889,"column":122,"offset":36197}}}],"position":{"start":{"line":889,"column":1,"offset":36076},"end":{"line":889,"column":122,"offset":36197}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":890,"column":1,"offset":36198}}}}